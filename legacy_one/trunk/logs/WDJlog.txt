[WDJ]	wesleyjohnson

START: 11/1/2009

*** w1_softerror
patchfile= w1_softerror.patch
- commit revision 544   by smite-meister
Adds a I_SoftError function, as an alternative to I_Error function
Softerror function prints message once, ignores messages already
printed, and returns to caller.
Changes some I_Error calls to I_SoftError

*** w2_doordelay
patchfile= w2_doordelay.patch
- commit revision 546    by smite-meister
Adds a Doordelay control variable and menu item
Alters the time that a door stays open.  Allows players to
succeed in overly difficult wads without resorting to noclip.

*** w3_gamma
patchfile= w3_gamma.patch
- merged with w25_gamma
Adds another, darker, gamma table.
See newer gamma generator.

*** w4_zalloc
patchfile= zalloc.patch,  zalloc_v2.patch
- merged with w22_zone
Two critical errors fixed in the Z_Malloc code.
See newer z_zone.c file, with more capability.

*** w5_heretic
patchfile= w5_heretic.patch
- commit revision 548   by smite-meister
Fixes bug that used up an inventory item with saving the game.
Fixes bug that crashed program when player time > 15 min.  (no sucks message)

*** w6_time_wrap
patchfile= w6_time_wrap.patch
- commit revision 549   by smite-meister
Fixes bug when time wrapped and program hung.

*** w7_flat
patchfile= w7_flat.patch
- commit revision 564   by smite-meister
Removes old change had flats searching the entire file, ignoring
F_START and F_END.  This failed for at least one wad, that had the same name
on a sprite.  Changed to honor F_START and F_END, and only when that fails,
then search entire file (so that gothic2.wad also works).

*** w8_voodoo
patchfile= w8_voodoo.patch
- commit revision 563    by smite-meister
Create voodoo dolls for extra player1 start positions.
This is necessary for many wads, which use the voodoo dolls for timers
and action activators.

*** w9_demo
patchfile= w9_demo.patch
- commit revision 562    by smite-meister
Demo code is commented and all demo versions that cannot be played are
properly handled such as to prevent crashing the program.

*** w9.1_misc
patchfile= w91_misc.patch
- merged with w23_comment
Comments

*** w9.5_opt_debug
patchfile= w95_opt_debug.patch
- for debugging purposes, do not commit

*** w9.6_oldwater
patchfile= w96_oldwater.patch
- HOLDING
- patches to oldwater
- some comments as to parameter that oldwater needed
- OLDWATER should be removed

*** w9.7_sound
patchfile= w97_sound.patch
- todo
Patches sdl/i_sound to work.
 

*** w10_specials
patchfile= w10_specials.patch
- commit revision 552   by wesleyjohnson, 
Fix, clean and comment, Legacy special linedefs.
Fixes linedef type specials, for Boom and Legacy
Adds comments for linedef type specials.
Fixes comments in some other associated files.

*** w11_status
patchfile= w10_status.patch
- commit revision 553 
Fix bug where life and ammo status would have bad background after
a save game.  R_FillBackScreen called by G_DoSaveGame, which then did not
refresh status display, because of unsatisfied global tests.

*** w12_drawpatch
patchfile= w12_drawpatch.patch
- commit revision 554, 555,  by wesleyjohnson
Simplify the combination of DrawPatch and GetLump using PU_CACHE, by
creating a function that does both.  This brings most of the casual usage
of PU_CACHE into 3 DrawPatch functions.  This is in preparation for fixing
usage of PU_CACHE throughout the whole program.

*** w13_alloc_cache
patchfile= w13_alloc_cache.patch
- merged with w22_zone
- Careful analysis of the PU_CACHE usage and fixing any usage where it
crosses another call of Z_Malloc.
- Adds additional PU_IN_USE, PU_LUMP, PU_CACHE_DEFAULT, to help prevent
memory allocated from be deallocated while in use.

*** docs
patchfile= w15_docs.patch
- commit revison 565   by wesleyjohnson
- Update docs for release, and special linedefs
- Fixes docs for release 1.44
- Fixes editspec and associated docs to correctly describe the Legacy
special linedefs.

*** makefile
patchfile= w15_makefile.patch
- commit revision 566   by wesleyjohnson
Fix makefile to work with older make, that does not understand some new
make syntax.
Clear up use of LINUX, FREEBSD, keep consistent with docs,
make new usage explicit.
Add debug, optimization controls.

*** gets
patchfile= w15_gets.patch
- commit revision 567
Fix t_func.c to not use the function gets(), which is so bad the
compiler will warn of any use of it (it overruns the buffer).
Replaced it with fgets().

*** w16_segabor
patchfile= w16_segabor.patch
- commit revision 571
Brings over the segabor patches from Legacy 143beta_macosx.
Fixes the SHORT bug, which overused the SHORT and LONG macros to do endian swaps.

*** w17_rdraw
patchfile= w17_rdraw.patch
- commit revision 572
Rename of some rdraw variables to add the prefix rdraw_ to give them more unique names,
because they were named identical to some other variables in structs.  This makes it
much easier to grep or search for all uses, and to realize exactly which variable was
being used.

*** w18_SM
patchfile= w18_SM.patch
- commit revision 573
Make use of ENUM values for legacy flat modes, instead of int literals.

*** w19_plane_limit
patchfile= w19_plane_limit.patch
- commit revision 574
Correct R_MakeSpans to not overwrite startspan[] and to not corrupt yslope[] and
other static memory.  Limits the spans to valid ranges.
This bug was repeatably triggered by the big room in 3DHorror.wad.


*** w20
patchfile= w20_thing_status.patch
- commit revision 575
Add limit checks to thing drawing code that handles things split by
a Legacy 3D floor.  Cures bug that such things overdraw the
status bar.

*** w21
patchfile= w21_dc_source.patch
- commit revision 576
Cleanup of code in rdraw8, extraneous stmts, add comments,
fix some indentation.
Change some temps to use stdint types.

*** w22_zone
patchfile= w22_zone_alloc_patch
- commit revision 577
Reissue of w13_alloc_cache patch, with matching z_zone file.
Careful analysis of the PU_CACHE usage and fixing any usage where it
crosses another call of Z_Malloc.
Adds additional PU_IN_USE, PU_LUMP, PU_CACHE_DEFAULT, to help prevent
memory allocated from be deallocated while in use.

*** w23_comment
patchfile= w23_comment.patch
- commit revision 578
Fix indentation to match surrounding, spelling.
Add comments to record.
Add {} on FOR and IF with multiple lines, to clarify reading.

*** w24_init_warnings
patchfile = w24_init_warnings.patch
- commit revision 579
Fix stmts that give compiler warnings about variable be used uninit.
Large amount of re-indentation and added {} in p_spec.c.

*** w25_gamma
patchfile = w25_gamma.patch
- commit revision 580
Replaces w3_gamma.  Compile option with multiple gamma table generators.
Adds control to select gamma table generator.
Removes old gamma tables.
Adds Effects menu, because video menu too crowded with added gamma
controls.

*** w26
Remove  screen.c.rej
patchfile = w26.patch
- commit revision 584
Misc patches to remove compiler warnings, and cleanup interfaces.
No net effects on execution.

*** w27
patchfile = w27.patch
- commit revision 585
Fix legacy.dat wadversion test to accept version 142 wad.
Misc patches to remove compiler warnings.

*** w28_setup
patchfile = w28_setup.patch
- commit revision 586
Fix bug introduced in w24, where save game writes bad save files.
Caused by init of sectors to NULL, and is unexplainable.

*** w29_sound
patchfile = w29_sound.patch
- commit revision 587  by wesley johnson
Fix (again) the heretic sound, where names are different than Doom.
Fix (again) some sound code for SDL.

*** w30_wad_swap
patchfile = w30_wad_swap.patch
- commit revision 588  by wesley johnson
First part of extensive changes for problem of endian conversion of
patches as they are displayed.  Creates the support SWAP macros and
the wad functions for using them.

*** w31a_swap_patch
patchfile = w31a_swap_patch.patch
- commit revision 589  by wesley johnson
Second part of changes for endian conversion.
Uses new macro names where needed in network code.
Removes endian code from draw patch code.
Creates new draw patch functions to simplify the usual _NUM and _NAME calls.
Extensive checking and comments on all endian swaps, fixed several places where
endian swaps were applied where they should not.

*** w31b_swap_patch
patchfile = w31b_swap_patch.patch
- commit revision 590
Third part of changed for endian conversion.
Covers hardware and other subdirectories that were missed in part 2.

*** w32_round
patchfile = w32_p3.patch
- commit revision 591
Gives alternative for round and roundf in video.  They are not standard library
and are C99 only.

*** w33_b_node
patchfile = w33_b_node2.patch
- commit revision 592
Adds a test for indexes out-of-bounds before accessing the b_node array.
This stops legacy from having a segfault for some wads with minor flaws,
like using a Boom linedef 244 instead of 242.
Also fixes some indenting and add some brackets to make readable.

*** w34_zone
patchfile = w34_zone.patch
- commit revision 593
Fix possible failing of Z_FreeTags when it combines free blocks.
Change size_t to uintptr_t, per stdint.h.
Mark free blocks with id.
Remove id and tag as PU_INVALID, blocks that are destroyed.
Create PU_PRIV_CACHE level, which does not get purged until 2nd pass of
trying to allocate in Z_Malloc.  These can be used for those cached
blocks that require considerable processing to create, like multi-patch
textures.

*** w35_texture_generate
patchfile = w35_texture_generate.patch
- commit revision 594
Fix segfault in phobiata.wad.  It has a texture of one patch, but that
patch is smaller than the texture.  The draw routine segfaults upon
trying to access texture columns that are not in the patch.
The new function will create in the patch cache a new patch of the dimensions
of the texture, using the patch columns.  All columns will exist.
Wad structures in the headers are changed to use stdint types, so they are
not dependent upon machine word size.
Comments are added to document discovered information.
Some names are changed to better reflect their intended usage, and
reduce confusion with the same name in different usage.

*** w36_draw_clip
patchfile = w36_draw_clip.patch
- commit revision 595
Fix segfaults due to low level draw using bad ylookup[].
The video column lookup table, ylookup[], is only as wide as the view window.
The low level draw routines RANGECHECK now checks against the view window
instead of vid.width and vid.height.
All callers of the low level draw routines now check their parameters
against the view window boundaries before calling.
Added some tests to intercept bad sprite ptrs caused by wads without all
the sprites present.
Comments are added to document discovered information.
Some names are changed to better reflect their intended usage, and
reduce confusion with the same name in different usage.

*** w36b_draw_clip
patchfile = w36b_draw_clip.patch
- commit revision 599
Move some {} and put \n on some I_SoftError.

*** w37_multi_patch_texture
patchfile = w37_multi_patch.patch
- commit revision 600
Added capability to combine patches (from a multi-patch texture) into
one patch, that has transparent regions.  This is needed for phobiata.wad
and makes a great difference in the appearance.  The gates and fences
can now be seen through.
Added texture_model field to texture to replace using test on
numpatches to determine drawing routine.

*** w37_things_print
patchfile = w37_things_print.patch
- commit revision 601
I_SoftError messages in things.c were missing a \n.

*** w38_enemy
patchfile = w38_enemy.patch
- commit revision 602
Fixed some test logic to include testing for valid ptr to target before
using the ptr.  This stops segfaults that happen in heavy fighting.

*** w37_compiler_msg
patchfile = w37_compiler_msg.patch
- commit revision 603
Fixed switch stmts to not give compiler message.  This was done before
in w37 but got lost before commit.

*** w39_overflow
patchfile = w39_overflow.patch
- commit revision 607
Stops overflow in sofware rendering from drawing large bars on screen.
Cleans up display of phobiata.wad map07.

*** w39b_overflow
patchfile = w39b_overflow.patch
- commit revision 611  by wesley johnson
Intercept top < bottom errors in software rendering so they do not interact with
overflow trap.

*** w40_makefile
patchfile = w40_makefile_v3.patch
- commit revision 612
Restore user and debug controls in makefile.
Support edit of makefile to select system media, debug, optimization.
Dependency files generated from makefile.
Remove makedep.mak which was not being maintained.

*** w40_makefile_v4
patchfile = w40_makefile_v4b.patch
- commit revision 614
Some dependencies not covered by previous patch.
Disable of automatic dependency generation was needed, user can choose.
DEBUG var set from command line is not modifiable in makefile.
- clashed with changes by smite

*** svn612_reaction
patchfile = svn612_reaction.patch
- commit revision 615
Some adjustments to large compiler-error removal patches.
Some compilers put comments after macros into the macro expansion, with dramatic failure.
Adjusted and commented realloc of drawsegs, with alternative code.

*** w40_makefile_v4d
patchfile = w40_makefile_v4b.patch
- commit revision 617
Make debugging easier by including video change.
Re-Re-adjusted CFLAGS.

*** w40_misc
patchfile = w40_misc.patch
- commit revision 618
Misc. cosmetic and alignment.
Preparation for savegame improvements.

*** w40_tarray
patchfile = w40_tarray.patch
- commit revision 619
Inconsistencies in t_array allocation.
Gave it some protection until issue is finally determined.
Some cosmetic improvements too.
Preparation for savegame improvements.

*** w40_GDESC
patchfile = w40_GDESC.patch
- commit revision 620
Preparation for savegame improvements.
Made a table of most game strings and settings.
Table is now searched.
Added command line forcing switches to force a mode selection
without having to rename files.
Added wad_selection.txt documentation.
Removed game name string allocation that was lost memory.

*** w40_savegame
patchfile = w40_savegame.patch
- commit revision 621
The big savegame change.
Added headers to savegame.
Savegame sync bytes are written and checked.
Provision for optional savegame sections.
Checks to not load savegames of different word length or endianess.
Checks that wad and game are same as when saved.
Made saving of raw structures more robust.  Easier for
programmer to support and helps avoid making silent errors in savegame.

*** w41_draw_clip
patchfile = w41_draw_clip.patch
- commit revision 622
Revisit of w36_draw_clip.
Severe display artifacts observed on flats in Twilight.wad, but not in
other wads, which are fixed by this patch.
Remove a test on dc_x as it was skipping needed loop end operations.
Limit range of dc_x earlier, as calls to SegLoop can have x1..x2 range
exceed the screen.

*** w41_dehacked
patchfile = w41_draw_clip.patch
- commit revision 623
Dehacked file pl2.deh (plutonia2) segfaults due to writing string over const.
String replacement changed to use Z_Strdup, and old string is abandoned,
as it could be a const.  There is no good test to recover allocated
strings, but dehacked does not encounter many of those, and executes only
once at load time.

*** w41_draw_clip_b
patchfile = w41_draw_clip_b.patch
- commit revision 624
Phobiata.wad had a bright line on right edge of screen.
Test to limit rw_stopx changed from rdraw_viewwidth-1 to rdraw_viewwidth
because the loop range of dc_x is rw_x .. rw_stopx-1.

*** w41_sound
patchfile = w41_sound.patch
- commit revision 625
Adds conditional code that makes sound work for systems with old SDL
versions.   When detecting an old version of the SDL mixer include file,
code is inserted to write the midi file to a tmp file and load it
the old way.

*** w41_makefile
patchfile = w41_makefile.patch
- commit revision 626
Fixes dependencies so that they are recognized by MAKE.
This fix may only work on Linux.

*** w41_main
patchfile = w41_main.patch
- commit revision 627
Makes the legacy home directory available to the savegame code.
Simplifies some of the directory string copies.
Preparation for savegame directories and files.
Removes some old code.

*** w41_savegame_time
patchfile = w41_savegame_time.patch
- commit revision 628
Adds the level time to the savegame header.
Fixes error messages.
Handles a NULL mobj pointer, instead of I_Error on it.

*** w41_savegame_dir
patchfile = w41_savegame_dir.patch
- commit revision 629
First cut at improving savegame menu system.
These are a work in progress, and are not finished.
Controled by defines  SAVEGAME99, SAVEGAMEDIR, as set in doomdef.h.
Adds ability to have 99 savegames.  Still cannot see more than 6.
Not all controls are finished.
Adds ability to have savegame directories.
This code works and is playable, but network game save will change in
future revision.

*** w42_message
patchfile = w42_message.patch
- commit revision 630
Simple message function.

*** w42_savegame
patchfile = w41_savegame_dir.patch
- commit revision 631
Cleaned up savegame menus.
Made legacy home string separately available.
Added directory and savegame delete.
Added directory and savegame scrolling.
Except for system dependent directory scanning, this finishes
the savegame revision.

*** w43_modelsector
patchfile = w43_modelsector.patch
- commit revision 632
Clean up use of sector models for Boom deep water and Legacy water.
This changes uses of sector->heightsec to be a model sector reference,
and changes most tests against it to be against sector->model.
This excludes special colormap sectors from being treated as water
sectors and properly ignores their floor and ceiling levels.
Enforce protection against model sector=-1 at the time sector model is set,
thus removing many unnecessary tests and making code intent clear.
Change some repetitive array accesses to use ptrs, reducing code size.

*** w44_byteswap
patchfile = w44_patchfile.patch
- commit revision 633
Finishes change from LE_SHORT, LE_LONG, to LE_SWAP16 and LE_SWAP32.
Fixes midi file big-endian uses to use BE_SHORT and BE_LONG.

*** w44_quicksave
patchfile = w44_quicksave.patch
- commit revision 634
Fix quicksave getting clobbered by save or load.
Fix quicksave to be able to change save file.
Fix quickload to correct message

*** w45_naming
patchfile = w45_naming.patch
- commit revision 637
Change some immature language to something more useful.
FIXED_TO_FLOAT_MULT
FIXED_TO_FLOAT( x )  : changed to use FIXED_TO_FLOAT_MULT
  changed divide to multiply, got smaller code
Comments, and other edits that do not change code generated.

*** w46_hardware1
patchfile = w46_hardware1.patch
- commit revision 638
Changes to the hardware renderer to fix some problems, and to clean it
up so other fixes are easier.

SPRITE_LIGHTLEVEL : convert sprite drawing to use same lightlevel
calculations that software renderer has been using.

TERM_TRANSFORM : generates precalculated combined transform terms that
reduces transforms per vertex to only 5 multiplies and 5 adds for
sprites, and 8 multiples and 8 adds for world.

DOOR_CLOSED_FIX : code from software renderer for closed doors. Not
enabled yet, needs checking.

Reduced lightlevel K-factor in LUT table from 2 to 1.2 to better match the
software renderer brightness.

Tests that rejects empty lines for trigger copied from software
renderer, as it has more conditions that seem important.

Code from r_bsp that determines the light levels of ceiling and floor,
taking into account multiple floors.

Code from r_things that fixes the problem with sprites being lighted
from the sector only.  It takes into account the 3D floors.

*** w47_main_GDESC
patchfile = w45_main_GDESC.patch
- commit revision 639
Tests of strife shareware were not recognized and caused segfault.
Finished Strife and Strife shareware additions.
Added needed lump recognition.
Added strife mode, (not implemented).
Fix change to -game switch so that unrecognized names cause error.
Other cosmetic and organizational adjustments and removed some old
comments and code.

*** w47_wad_selection
patchfile = w45_wad_selection.patch
- commit revision 640
User documentation changed to reflect strife and -game switch changes.

*** w44_quicksave
patchfile = w44_quicksave.patch
- commit revision 641
Commit quicksave again, quicksave changes are missing.
Fix quicksave getting clobbered by save or load.
Fix quicksave to be able to change save file.
Fix quickload to correct message

*** w47_naming2
patchfile = w47_naming2.patch
- commit revision 642
Another FIXED_TO_FLOAT, and some commentary.

*** w48_wad_structure
patchfile = w48_wadstruct.patch
- commit revision 643
Change structures used to access wad to use uint16_t and uint32_t.

*** w48_realloc
patchfile = w48_realloc1.patch
- commit revision 644
Check for failure on calls to realloc.  Moved expansion of realloc structures
to subroutines.  Gets them out of the code that is executed frequently
so they do not occupy space in the processor cache.

*** w48_struct_comments
patchfile = w48_comments1.patch
- commit revision 645
Comments added to main structures, as aid to debugging their use.

*** w49_animation_interpic
patchfile = w49_animinterpic.patch
- commit revision 646
Two animation structures had the same name.
Renaming of structures and some variables, to make reading and search
easier.
Comments added.

*** w49_animation_textures_and_flats
patchfile = w49_animtex.patch
- commit revision 647
Two animation structures had the same name.
Renaming of structures and some variables, to make reading and search
easier.
Comments added.
Eliminated storing -1 value in boolean field.
Eliminated extra entry needed for -1 terminator to list.
Changed test condition on one loop to instead test a count derived from
the other existing end-of-list indicator.

*** w49_medikit_message
patchfile = w49_medikit.patch
- commit revision 648
Fix from DoomWiki (wrong) and prboom (right) to known Doom bug.
When health < 25 and pickup a medikit, gives an special message.
Message did not appear because medikit gave +25 health before the
test was done.  Changed to test for 50 health after adding +25.

*** w49_ouch_face_on_damage
patchfile = w49_ouchface.patch
- commit revision 649
Fix from DoomWiki (and prboom) to known Doom bug.
When damage > 20, was supposed to give the ouch face.
The test subtraction was reversed, testing a negative damage.

*** w49_fraggle_proto
patchfile = w49_fraggle.patch
- commit revision 650
Functions in fragglescript files did not have prototypes, changed to (void).
Changed misuse of name floor (a library function) to mfloor.

*** w49_floor_rename
patchfile = w49_floor.patch
- commit revision 651
Rename usages of floor name (a library function) to mfloor.
Overloading of floor library function causes confusion with editors, and
potentional compile errors where the original library function gets used.
The bin size was reduced by about 1K.

*** w49_sector_rename
patchfile = w49_sectors.patch
- commit revision 652
Clarify usage of sector numbers in structures and code, and the list of
lines.  Use more unique names.
Rename sector lines[] to linelist[], and added comments.
Fix another use of floor name.

*** w50_planelight
patchfile = w50_planelight.patch
- commit revision 653
Split the R_GetPlaneLight function into two, to avoid the repeated
passing of a FALSE parameter.
Eliminated clutter of viewz test in parameter that is now done in function.
Reduced program size and faster execution.

*** w50_bsp_viewer_common
patchfile = w50_bspviewer.patch
- commit revision 654
Removes common determinations on the viewer model sector to a Setup
function.
The viewer variables are used by R_FakeFlat and R_RenderSprite.
This code is much easier to read and understand, and is smaller.
Makes model floor and ceiling transitions more consistent.
Old code is retained for comparison until such time as correctness is clear.

*** w50_friction
patchfile = w50_friction.patch
- commit revision 655
Investigating why prboom has different friction in mud than Legacy.
That may be due to control device issues and momentum.
Added some improvements from ZDoom and prboom, for heretic and hexen.
Comments and cleaned up some.

*** w50_blaze_door_sound
patchfile = w50_blaze_door_sound.patch
- commit revision 656
Fix from WikiDoom to known Doom bug.
When blaze door hits someone and goes back up, it plays the wrong sound.
Added test for blaze door to play appropriate sound.

***
- commit revision 657
WDJlog.txt  update

*** w51_hardware_world
patchfile = w51_hardware_world.patch
- commit revision 658
Hardware renderer use of world names fixed same as software renderer.
Some other name changes to more descriptive.

*** w51_textures
patchfile = w51_textures.patch
- commit revision 659
Commented code as to the conflict between texture[0] and 0=no-texture.
Added a fix for the conflict that allows the first texture to be displayed.
Some changes to names and array accesses.

*** w52_no_texture
patchfile = w52_no_texture.patch
- commit revision 660
Check for no texture, and prevent segfault.
Catches error when 3Dslab does not have side texture.

*** w52_attack_self
patchfile = w52_attack_self.patch
- commit revision 661  by wesley johnson
Documents a fix for a monster attacking itself.
See WikiDoom bugs.

*** w52_2player_segfault
patchfile = w52_2player_segfault.patch
- commit revision 662
Documents a bug that is not fixed.
When 2 players, with 2nd player not active, the second player will segfault
at the marked location, when the 1st player enters the lift on MAP01.
This would be the first act making a sound that the other player could hear.

*** w52_moving_sector
patchfile = w52_moving_sector.patch
- commit revision 663
Found too many uses of variable "move" in code, so renamed and commented
some of them.

*** w52_model_sector_colormap
patchfile = w52_model_sector_colormap.patch
- commit revision 664
Cleanup colormap setup in p_spec.c, and commented the special linedefs.
Rename the color mapping control sector as model_sector.

*** w52_colormap
patchfile = w52_colormap.patch
- commit revision 665
Extensive visit of all the colormap code.
Comment uses of colormaps.
Cleanup colormap setup in p_setup.c, and commented special linedefs,
and removed incomplete hardware renderer code for colormap generation.
Have hardware renderer use the same colormap generator function as the
software renderer, and same linedef setup.
Cleanup the colormap generator, comment, and have it calc hardware
renderer fields too.

*** w52_skintable_translations
patchfile = w52_skintable.patch
- commit revision 666
Too many uses of the term trans, confusing translucent and skin
translation.
The skin tables are renamed from translationtables to skintranstables,
and dc_translation becomes dc_skintran.
Define SKIN_TO_SKINMAP, MT_TO_SKINMAP, to bring indexing calculations
to one common place.
Create skin table lookup, which prepares code to have skin tables read
from files.
Rename the standard colormap tables as reg_colormaps, to differentiate
them from all the other things named colormap.

*** w52_lighttable
patchfile = w52_lighttable.patch
- commit revision 667
Use LIGHTTABLE on colormaps, hiding table indexing calculations.
Renamed the fakefloor lightlist_t to ff_lightlist_t to differentiate it
from the other r_lightlist_t.
Renamed some list uses to ff_list, to differentiate them from other lists.
Fixed expand_lightlist, gave it an error message on failure.

*** w52_translucent
patchfile = w52_translucent.patch
- commit revision 668
Spell out translucent, so can differentiate it from other trans operations.
Rename trans enum values to be readable.
Use translucenttable[xxx] syntax, instad of *(translucenttable + xxx).
Make table for translucent selection to GL conversion.

*** w52_draw_masked
patchfile = w52_draw_masked.patch
- commit revision 669
The R_RenderMasked routines have some global parameters.  Rename them
with dm_ so they can be easily identified.
Simplify some colormap code segments where there were redundant tests.

*** w52_fog_sheet
patchfile = w52_fog_sheet.patch
- commit revision 670
Fixes fog sheet bug, where fog sheet would not display in software renderer.
Adds code to clip the fog sheet properly.

*** w52_fog_floor_colormap
patchfile = w52_fog_floor_colormap.patch
- commit revision 671
Provided alternative code where FF_FOG test for setting colormap was
unusual compared to other places in the code.  Not sure which is
correct.

*** w52_hw_colormap
patchfile = w52_hw_colormap.patch
- commit revision 672
Bug fix, hardware renderer can now display Boom colormaps, and can now
display levels of colormap brightness.
Create R_ColormapAnalyze, to generate hardware rgba info from Boom colormaps.
Enhance the extra_colormap rgba field to be an array, selected by lightlevel.
This gives the opengl colormaps some lightlevel effect.
Enhance ColormapGenerate, to fill out the rgba lightlevel array.

*** w52_hw_transparent_wall
patchfile = w52_hw_transwall.patch
- commit revision 673
Sprites behind transparent walls are not drawn.
Transparent walls are drawn after the sprites so they can be overlayed.
There was work already done, that needed to be enabled.
Made it clearer and added comments.

*** w52_hw_bsp_viewer
patchfile = w52_hw_bsp_viewer.patch
- commit revision 674
Convert hardware renderer to use the same bsp viewer global variables
that are used in the software renderer, as in bsp.c.

*** w52_hw_brightness
patchfile = w52_hw_brightness.patch
- commit revision 675
Adjust hardware brightness again, because rgba[] now gives some darkness.

*** w52_hw_no_texture2
patchfile = w52_hw_no_texture2.patch
- commit revision 676
More no-texture tests needed in FakeFloor rover code, with wider protection.
A 3Dslab that is missing a side texture could cause a segfault, eventually,
when it is referenced during FakeFloor roving.

*** w52_VIEW_COLORMAP_GEN
patchfile = w52_view_colormap_gen.patch
- commit revision 677
Turn off VIEW_COLORMAP_GEN debug enable, which had got left on.

*** w52_hw_extracolormap_surf
patchfile = w52_extracolormap_surf.patch
- commit revision 678
Extracolormap_to_Surf, common function for hardware rgba[] handling,
because these operations are getting more and more complicated.
This was in w52_hw_colormap.patch, but was found to be missing after
the latest commit.
GetPlaneLight changes in hw_main.c.
These were in w50_planelight.patch, but were found to be missing after
this latest commit.

*** w53_drawsplats_looping
patchfile = w53_drawsplats_looping.patch
- commit revision 679
The usual test and continue for draw range too high, in this case, left
the iteration variable unchanged, and thus stuck in a tight loop.
Changed to not use continue stmt.

*** w53_chexquest
patchfile = w53_chexquest.patch
- commit revision 680
Fix chexquest problems.
Chexquest was showing bloody splats, provided by legacy.dat.
Added a GDESC_ flag to indicate that the iwad needs to have precedence.
Reduced the violence of the splats for chexquest mode.
Added code to detect and intercept Doom graphics that were left in the
chexquest1 wad by the developers.
When player escapes the difficulty menu, it goes to the episode menu,
which is displaying the Doom1 episode names to Chex players.
Added code to give Chex episode names, instead of Doom episode names,
or block the episode menu.

*** w53_bossdeath
patchfile = w53_bossdeath.patch
- commit revision 681
Fix from DoomWiki and prboom.
BossDeath logic from UltimateDoom does not work with some earlier PWAD.
Upon detect of shareware or registered, revert to earlier BossDeath
test, that allows all Boss types to trigger effect.

*** w53_buildstairs
patchfile = w53_buildstairs.patch
- commit revision 682
BuildStairs bug from DoomWiki, already fixed (mostly).
Init some more fields, init them even when not boomsupport,
moved stair attribute switch stmt out of the loop (const for the loop).

*** w53_line_of_sight
patchfile = w53_lineofsight.patch
- commit revision 683
Sleeping Sargeant bug from DoomWiki.
Line-of-sight code had typo, testing x==node->y, instead of y==node->y.

*** w54_dehacked
patchfile = w54_dehacked.patch
- commit revision 684
Dehacked file in chexquest-newmaps segfaults due to writing string over const.
String replacement in sprites changed to use Z_Strdup, and old string
is abandoned. This one was missed in previous dehacked patch.

*** w54_lightlist
patchfile = w54_lightlist.patch
- commit revision 685
Fix segfault in chexquest-newmaps due to lightlist bad value.
Init some special lightlist fields, and comment where segfault occurs.
Do not know how the level causes this, but it is repeatable.
With the init, the segfault is prevented, and there is no visible effect.

*** w54_crosshairs
patchfile = w54_crosshairs.patch
- commit revision 686
Chexquest-newmaps has a scope with crosshairs, that for the software
render is considerably off to the left.
Center the fragglescript pictures overlayed upon screen so that the
scope crosshairs line up with the actual firing point.

*** w54_new_chexquest
patchfile = w54_newchexquest.patch
- commit revision 687
Chexquest-newmaps and others have more than the original 5 maps.
When a there is a -file (gamemodified=1), then allow all episodes and maps.

*** w55_savemobj
patchfile = w55_savemobj.patch
- commit revision 689
Savegame repeats mobj numbers when more than 1023 mobj.
Seen in hth2.wad (Hi-Tech Hell 2 - Alien Tech), which saves 1899 thinkers.
Realloc of mobj list fixed.

*** w55_maxcolormap
patchfile = w55_maxcolormap.patch
- commit revision 690
Wad hth2.wad uses 38 colormaps, increase to 64 colormaps.
Comment some colormap vars, and make it more clear.
Not enough memory saved to use dynamic methods.

*** w56_savemenu_scroll
patchfile = w56_savemenu_scroll.patch
- commit revision 691
Fix savegame menu so that when pressing uparrow or downarrow the scrolling
is performed whenever it can, instead of rollover to top or bottom
of menu.

*** w56_legacy_docs
patchfile = w56_legacy_doc.patch
- commit revision 693
Updated the Legacy.html to reflect new controls and switches.
This is not complete.
Updated a little bit of Faq.html, but much of it still needs review.
There are still many references to newdoom in the doc pages.

*** w57_trymove
patchfile = w57_trymove.patch
- commit revision 694
Comments added for TryMove, LineAttack.
Rename TryMove global vars to tm_* and the return global vars to tmr_*.
Rename LineAttack global vars la_* and the return global vars to lar_*.
Cleanup some function stubs, and some indenting, and some IF stmts
to make easier to read.

*** w57_sight
patchfile = w57_sight.patch
- commit revision 695
Comments added for Sight functions.
Rename CheckSight global vars to cs_*, and the return global vars to
see_* (which are also used independently by P_AimLineAttack).
Rename SightTraverse hsight global vars to strav_*.

*** w57_largemap
patchfile = w57_largemap.patch
- commit revision 696
Fix some math overflow for large maps like Europe.wad, where MAP01 is
enormous.
Change some short wad field types to uint16_t where needed, as those fields
could be overflowed and they do not need a sign.
Detect some buggy wad conditions and correct it as much as possible, 
or Error msg exit, at least prevent segfaults.
Detect bad linedef number, missing sidedefs, in P_LoadSegs.
Detect missing sidedefs, in P_LoadSubsectors.
Detect bad sector number, in P_LoadSideDefs2.
Detect bad seg number, in P_GroupLines.

*** w57_blockmap_overlow_coping
patchfile = w57_blockmap.patch
- commit revision 697
Fix blockmap loading to handle large blockmaps.
Detect blockmap overflow and correct the list indexes.
Will load Europe.wad which overflows the blockmap x3 times.
Europe.wad will load and run after this patch, but has automap problems,
and some other bugs.
Rename the blockmap global vars to be less confusing, as blockmaphead
and blockmapindex (as neither is the lump).
Make the blockmap unsigned, because every value read from it is unsigned
except for one test, which can be ==0xffff instead.
Adjust some of the blockmap functions.

*** w57_automap_overflow
patchfile = w57_automap.patch
- commit revision 698
Fix automap to handle large maps like Europe.wad.
Do math as to avoid overflowing integer math.
Detect when overflow will happen and limit zoom to prevent it.
Change conversion calculation to floating point math.
Removed some unused code using #ifdef 0.
Rewrote some parts to use center of attention instead of corner of
window, and cope with map edges better.

*** w58_r_defs
patchfile = w58_r_defs.patch
- commit revision 715
Comments on many r_defs structure fields.
Comment out unused ff_delta field.
Comments where ff_delta was initialized.

*** w58_attached_memory_leak
patchfile = w58_attached_memory_leak.patch
- commit revision 716
Free memory allocated to sector->attached before freeing sectors in
ZMalloc purge.
Init sectors list pointer, now that it no longer causes save game
corruption.

*** w58_silhouette
patchfile = w58_silhouette.patch
- commit revision 717
Rename some silhouette fields and function variables so can understand
how they are being used.
tsilheight -> sil_top_height
bsilheight -> sil_bottom_height
sprtopclip -> spr_topclip
sprbottomclip -> spr_bottomclip

*** w58_top_patch
patchfile = w58_top_patch.patch
- commit revision 718
Clarify some draw_masked and render segs variables, so can understand
how they are being used.  Preparation for attacking 3Dfloor sprite bugs.
Standardize some render function defines.
dm_topscreen -> dm_top_patch
dm_botscreen -> dm_bottom_patch
topscreen -> top_post_sc
bottomscreen -> bottom_post_sc
local light index -> dlit

*** w58_viewangle
patchfile = w58_viewangle.patch
- commit revision 719
Rename of viewangle arrays to make them readable.
xtoviewangle -> x_to_viewangle
viewangletox -> viewangle_to_x

*** w58_visplane_hash
patchfile = w58_visplane_hash.patch
- commit revision 720
Clarified the visplane hashing, renamed, and rewrote some free list
functions, to make it more explicit and understandable.
Plane freelist had head and tail reversed from usual list interpretations.
Gave visplane base the naming  vispl_*.
Gave visplane global parameters the naming  vsp_*.
Because of longer names the code got larger.
Running it through strip, removing the symbols, shows the true code size.

*** w58_visplane_naming
patchfile = w58_visplane_naming.patch
- commit revision 721
Preparation for attacking 3Dfloor sprite bug.
Naming changes, spacing, etc.
Renamed some structure fields to be explict, such as front_frac and
back_frac (instead of f_frac and b_frac), and high_top instead of just high.
Standardize some strange function declarations.
Many comments added.
No logic changes.

*** w58_visplane_revision
patchfile = w58_visplane_revision.patch
- commit revision 722
Preparation for attacking 3Dfloor sprite bug.
Small changes here and there to clarify code.
Simplified R_ExpandPlane, it was copied from CheckPlane and mostly
irrelevant.
Floor rover renamed to fff, and bff, which changes many lines, but makes
it clearer which is which.

*** w58_missed_stuff
patchfile = w58_missed_stuff.patch
- commit revision 726
Some local renames and comments that belonged with w58 that were missed.

*** w59_whatsnew
patchfile = w58_whatsnew.patch
- commit revision 738
Update whatsnew.html with new features, bug fixes, and known bugs from
my notes.
Update legacy.html with gamma table.
Update console.html with gamma commands.

*** w60_gcc4.4.4_complaints
patchfile = w60_gcc4.4.4_complaints.patch
- commit revision 746
Fix some valid gcc 4.4.4 compiler complaints.

*** w60_automap_status
patchfile = w60_automapstatus.patch
- commit revision 747
Automap is messed up for some screen sizes and splitscreen.
Fix bug made in w57_automap_overflow, by restoring original draw sizes.
Automap does not adapt to splitscreen, nor screen size, and has its own
status bar adaptation.

*** w60_displayplayer
patchfile = w60_displayplayer.patch
- commit revision 748
Add variables consoleplayer_ptr, displayplayer_ptr, displayplayer2_ptr.
To fix splitscreen displayplayer tests to not segfault.
This does NOT fix the splitscreen specific segfault causes.
These variables save on many tests of players[consoleplayer] and can
be tested against other player ptrs, and fixes clumbsy tests of
ptr against index.
Reduces code size by about 3K.

*** w60_splitplayer
patchfile = w60_splitplayer.patch
- commit revision 749
Fix splitscreen player2 failure that has existed for a long time.
Splitscreen player was not being created because even local play uses commands
sent through the network code, and they were being sign extended into nonsense.

*** w60_splitsound
patchfile = w60_splitsound.patch
- commit revision 750
Fix sound code segfaults in splitplayer mode.

*** w60_splitdemo
patchfile = w60_splitdemo.patch
- commit revision 751
Prevent demos from destroying an existing split player setup.

*** svn744_makefile
patchfile = svn744_makefile.patch
- commit revision 753
Linux 2.4 and others still have GLU lib in /usr/X11R6/lib.

*** w61_texture_combine
patchfile = w61_texture_combine.patch
- commit revision 755
The wad caesar.wad causes a texture failure.  Making allocation slightly
larger prevents this failure.

*** w61_effects_menu
patchfile = w61_effects_menu.patch
- commit revision 756
Make Effects menu permanent.  Next changes will add to it and too
difficult to cope with it being optional.

*** w62_patch_combine
patchfile = w62_patchcombine.patch
- commit revision 757
Patch combine fixes.
Detect empty patch properly instead of letting large value represent it.
Handle posts longer than 255 by creating a separate post, instead of error
escape.
Improve some messages, and comments.

*** w62_PNG
patchfile = w62_PNG.patch
- commit revision 758
Detect PNG patches, to prevent them from crashing the draw routines.
Create a dummy patch to replace them.
Test wad is longdays.wad, which has a PNG patch.

*** w62_sprite_limit
patchfile = w62_sprite_limit.patch
- commit revision 759
Remove sprite limits.  A user setting allows from 128 to 16000 sprites.
Sprite tables are dynamically adjusted according to previous frame
sprite count, and user setting (soft limit) in Effects menu.
Table size is hard limited to twice the user setting.
Nearest sprites to player have preference.
When there are more sprites than the table size (>256) the farther sprites
have semi-random access to last half of table (sporatic visibility,
they flicker), so the player knows there are more sprites in the distance.
Sprites are sorted by scale as they are inserted into table, so sprite
sort routine is ifdef'ed out.
Test wad is longdays.wad, which has thousands of sprites.
Test at user setting of 128 sprites, upto when your computer bogs down.

*** w62_crush_floating_monster
patchfile = w62_crush.patch
- commit revision 761  by wesley johnson
Fix monster height vrs room logic that due to some strange fix, had
floating monsters getting away from crushing ceilings undamaged.
Changed logic around so crush test is done first, and then can be
modified for special cases.  The special cases I found are limited,
but this is much easier to maintain without breaking it again.
I have tested this on several wads with crushers and it appears to work,
and I have verified that cacodemons and heads get crushed now.
It could use more testing for the strange special cases that I do not
know about.

*** w61_boom_demo
patchfile = w61_boom_demo.patch
- commit revision 762
Fix demo player to understand Boom demo headers.
This stops them from crashing the playback machine.
This patch got lost, which is why it is out of order.

*** w63_texture_size
patchfile = w63_texture_size.patch
- commit revision 763
Set texture size variable txcblocksize.
Stops compiler from complaining, which was right, although it took me
a long long time to find it.

*** w63_PU_LOCK_SB
patchfile = w63_PU_LOCK_SB.patch
- commit revision 764
The statusbar background was still getting released from memory.
Added a locked allocation, PU_LOCK_SB, which users of PU_STATIC cannot
release using ChangeTag.  ChangeTag requires use of PU_UNLOCK_CACHE to
change the PU_LOCK_SB to PU_CACHE.
Changed some temp uses of PU_STATIC to PU_IN_USE or PU_LUMP, which will
not release the memory if another user had the same patch with PU_STATIC.

*** w63_switch_endian
patchfile = w63_switch_endian.patch
- commit revision 765
Loading of switches has endian conversion that should be conditional
on BIG_ENDIAN, and needed to be done only when loading cache, not on
cache hits.

*** w63_doommode
patchfile = w63_doommode.patch
- commit revision 766
Alter the doommode enum names to reflect the actual games.
doom_shareware, doom_registered, ultdoom_retail, doom2_commercial
Found bad enum tests: "if (shareware)" and fixed them
as "if (gamedesc_index == GDESC_heretic_shareware)".

*** w63_GDESC_improve
patchfile = w63_GDESC_improve.patch
- commit revision 767
Revised GDESC_ code to have three alternative filenames for each entry.
This allows the engine to check several alternative filenames, to
allow a unique name and a common name, and to cover both filenames for
Ultimate Doom without needing two separate Ultimate Doom entries.
The id code is now specified in a field to make it independent of the
entry position in the table.
Removed code for -shdev, -regdev, -comdev, and replaced it with one
simpler switch, -devgame <gamename>, to remove the only need to know the
index of GDESC table entries.  Probably, those switches have not
been used since Doom development in the 90's.

*** w63_wikibugs
patchfile = w63_wikibugs.patch
- commit revision 768
Comment fixes to bugs described in wikibugs.

*** w64_savegame_limit
patchfile = w64_savegame_limit.patch
- commit revision 769
Savegame size limits removed.  Longdays.wad has savegame size from 468K to 806K.
Savegame was made to work within a 128K buffer, by reading and
writing when the free space is less than 1024 bytes.  Error detection,
buffer allocation, and deallocation, and file access is encapsulated within
the savegame functions.
The network also transmits savegame to a new user.  When there is not
a file then the savegame function reallocs a larger savebuffer, as needed.

*** w65_savemenu_bugs
patchfile = w65_savemenu_bugs.patch
- commit revision 770
Fix a number of nusance bugs in the savegame menu system.
Puts a ".." string in the UP-TO-LEGACY directory menu entry.
Fix allows new directory to be created from DIR line and from any
blank directory entry.
Fix directory menu scrolling to stop at end.
Fix savegame and directory menu failure after delete entry.
When current directory is deleted, fixed to null savegamedir name.
Fix "EMPTY SLOT" message being presented as a savegame name, by
preserving the slot status for all scrolling.

*** w65_old_patch_remove
patchfile = w65_old_patch_rem.patch
- commit revision 771
Remove old unused patch remanant.
Preliminary to fixing draw sprite vrs 3dfloor bug.

*** w65_old_vissort_remove
patchfile = w65_old_vissort.patch
- commit revision 772
Remove old unused vissprite sort routine.
Preliminary to fixing draw sprite vrs 3dfloor bug.

*** w65_plane_drawnode
patchfile = w65_plane_drawnode.patch
- commit revision 773
Sort floor planes into the drawnode list as they are traversed instead of
the previous repeated search of the same data.
Preliminary to fixing draw sprite vrs 3dfloor bug.

*** w65_savegame_line_ptr
patchfile = w65_save_ptr.patch
- commit revision 774
Fix segfault in DoomII MAP27 on use of door->line.
The line may be NULL.  Fixed savegame to save and restore NULL ptrs
for line and mapthings.
                                                            
*** w65_savegame_get_put
patchfile = w65_savegame_get_put.patch
- commit revision 775
Two savegame functions use local vars get and put, and these must be
copied to and from save_p before and after SG_Readbuf and SG_Writebuf.
Changed value 1024 in SG_Readbuf and SG_Writebuf to a defined trigger value.
Increased free space trigger to 2048 bytes.
Added optional code to test and print minimum free space in the
savegame buffer.

*** w65_sprite_limit_fix
patchfile = w65_sprite_limit_fix.patch
- commit revision 776
Fix a minor error in testing for request = current.

*** w65_farthest
patchfile = w65_farthest.patch
- commit revision 777
Move some variables that were made conditional into the conditional code
so the compiler stops complaining about variables not used.

*** w66_save_SGI
patchfile = w66_saveSGI.patch
- commit revision 779
Savegames for SGI will no longer pad the savegame to align reads and writes.
Padding will not work with the new savegame buffer, as it does not keep
a fixed alignment.  The WRITEU16, and similar inline functions should
perform unaligned byte transfers to the buffer, if needed.

*** w66_alpha2_docs
patchfile = w66_alpha2_docs.patch
- commit revision 780
Update the docs for latest news, bug fixes, and update some legacy
usage instructions.

*** w66_buggy_wad
patchfile = w66_buggy_wad.patch
- commit revision 781
More checks against buggy wads.

*** w67_colormap_msg
patchfile = w66_colormap.patch
- commit revision 782
Fix bad colormap missing msg.

*** w67_linedef
patchfile = w66_linedef.patch
- commit revision 783
Decode boom generalized linedef better, so to detect bad linedef numbers.
More efficient switch linedef executable.

*** w67_plutonia
patchfile = w66_plutonia.patch
- commit revision 784
Bad detection for plutonia, CAM01 needed to be CAMO1.

*** w67_stop_demo
patchfile = w66_stop_demo.patch
- commit revision 785
Stop demos when menus are open.  They keep stealing the keypresses and
make it impossible to use the menus.

*** w67_player_spawn
patchfile = w66_player_spawn.patch
- commit revision 786
Convert player spawn code to pass playernum as parameter instead of
mangling the wad things.  This allows the wad things to be searched
again.

*** w67_savegame_netvars
patchfile = w66_savegame_netvars.patch
- commit revision 787
The savegame format changes everytime some more cv_ netvars are added.
This change makes the savegame load immune to this.  It will read
netvars until it hits the SYNC mark, instead of reading according the
the NETVARS found in this version.  This allows older savegames to
still load.

*** w67_voodoo_player
patchfile = w67_voodoo_player.patch
- commit revision 788
Due to wads that use the voodoo player in strange ways, the voodoo
player has appeared as the player in some function calls.  This will
segfault when trying to get the player index [player - players].
Fix by creating the voodoo player more like vanilla doom does it, and
then intercept the problems as they occur.
Provides an instadeath control for voodoo telefrag mitigation.
In deathmatch, the voodoo telefrag is blocked.
Provides a voodoo_mode to control voodoo effects, with settings
Vanilla, Multispawn, Target, and Auto.
In Vanilla, voodoo dolls can create zombies and the walking dead.
Other modes prevent those from occuring by redirecting damage to the
player.
In Multispawn mode the voodoo doll player gets the damage.
In Target mode the player that shot the voodoo doll, or last triggered
a linedef, or last pushed a switch, will get the damage.
Target mode is meant for coop and deathmatch.
In Auto mode it behaves as Target, unless it detects voodoo dolls for
players other than player1, upon which it will change to Multispawn.
Plutonia MAP06 is a known voodoo Multispawn level.

*** w67_doc
patchfile = w67_doc.patch
- commit revision 789
Update docs for w67 patches.

*** w67_stop_demo2
patchfile = w67_stop_demo2.patch
- commit revision 790
Fix Stop Demo patch that got somewhat mangled.  Also added restore of
screen and demo after the menu is exited.

*** w67_deathmatch_voodoo
patchfile = w67_deathmatch_voodoo.patch
- commit revision 794
Fix extraneous voodoo dolls spawned in deathmatch, broken by voodoo
patch.

*** w67_coop_damage
patchfile = w67_coop_damage.patch
- commit revision 795
Fix damage tests to allow monster damage during coop play, broken by
voodoo patch.

*** w68_braintargets
patchfile = w68_braintargets.patch
- commit revision 796
Remove hard limits for braintargets, similar to prboom.
Prevents overrun of braintargets array.
Resolves bug 1001667, from 2004.

*** w68_vile_bugs
patchfile = w68_vile_bugs.patch
- commit revision 797
Vile ghost fix commented.
Vile revived stuck together bug fixed, similar to zdoom and prboom,
fixing bug 1037683.
Vile fire location bug fixed, similar to prboom.

*** w68_menu_exitgame
patchfile = w68_menu_exitgame.patch
- commit revision 799
Fix game menus, so that the check for "already playing" will give
the user an immediate message asking "Abort this game Y/N".  Upon a
YES it will quit the game and let the user continue.
Combine 3 static menu msg buffers into one large one.  There can
be only one menu message at a time.

*** w68_menu_mouse
patchfile = w68_menu_mouse.patch
- commit revision 800
Fix mouse bugs in menus.
Fix so mouse cannot change values until button pushed, because previously
one mouse slide could accidently change a dozen values.
Extraneous mouse tracking removed.
Menu mouse sensitivity put in a define and lowered.

*** w69_fs_rename
patchfile = w69_rename.patch
- commit revision 801
Rename global fragglescript variables to fs_.
Apply standard indenting.
Rename enum defs to TT_ BRACKET_ FSVT_ and FSST_.
Other minor cleaning.

*** w69_fs_parse
patchfile = w69_parse.patch
- commit revision 802
Fix fragglescript parsing to use safer, faster
string handling code, to protect against overrun of strings.

*** w69_fs_args
patchfile = w69_fs_args.patch
- commit revision 803
Simplify fragglescript function args concatenation.
More indenting and cleanup.

*** w69_fs_misc
patchfile = w69_fs_misc.patch
- commit revision 804
Fix some extern defs in fs code to use header file.
Rename some enum as WT_.
Change some sprint into snprint.
Some other minor cosmetic changes.

*** w69_fs_var_rename
patchfile = w69_fs_var_rename.patch
- commit revision 805
Rename fragglescript var and value types.
Rename array savelist and types.
Rename Init of arrays.

*** w69_fs_docs
patchfile = w69_docs.patch
- commit revision 806
Fix docs for latest patches.

*** w70_timelimit_bug
patchfile = w70_timelimit.patch
- commit revision 807
Fix timelimit to use tics, fixing bug 989967.

*** w70_savegame_spaces
patchfile = w70_savegame_spaces.patch
- commit revision 808
Fix code so savegame description allows spaces again.

*** w70_pld_Makefile
patchfile = w70_pld_Makefile.patch
- commit revision 809
Fix Makefile to link with "-lm" because of MATH1 functions pow and powf.
Submitted by pld-Linux patch lib.

*** w70_pld_linux_x_video
patchfile = w70_pld_linux_x_video.patch
- commit revision 810
Accept some patches submitted from pld-linux patch lib.
In linux_x port, handle larger number of vidmodes without crash.
In linux_x port, do not force Colormap upon X, when not in x_pseudo
(TrueColor) we handle colormapping.

*** w70_netcmd_WRITESTRINGN
patchfile = w70_netcmd_WRITESTRINGN.patch
- commit revision 814
Linux 2.6 compile warning messages squashed, and smaller code.

*** w71_kin_progress
- commit revision 815
Move kin log file "progress.txt" from linux_x/ to _logs/.

*** w70_TNT
patchfile = w70_TNT.patch
- commit revision 816
Fix TNT recognition.

*** w71_linux_x
patchfile = w71_linux_x.patch
- commit revision 817
General repairs to linux_x directory.
Update system calls to same changes as made recently to SDL.
Fix prototype changes.
Deactivate unused code and obsolete code.
Fix keyboard translation and event posting.
Add X error handler code.
Fix X joystick code.
Verified to run Linux X11 in software mode.

*** w72_spritelump_type
patchfile = w72_spritelump_type.patch
- commit revision 818
Combine sprite lump tables into one record and array.

*** w72_spritelump_limits
patchfile = w72_spritelump_limits.patch
- commit revision 819
Fix spritelump array to be dynamic expanded, thus removing spritelump
limits.  This fixes the last issue of bug 3157859.

*** w72_dehacked
patchfile = w72_dehacked.patch
- commit revision 820
Fix dehacked special string copy to use Z_Strdup like the other fixes,
so do not write const string.
Some minor code changes.
Add some comments and {}.

*** w72_cheat_char
patchfile = w72_cheat_char.patch
- commit revision 821
Fix CheckCheat to use the ASCII char in the event (data2), and not the
16bit char in data1, to avoid special keys being mistakenly recognized.
The cheat code saw the 0 key =0x48 and LSHIFT key =0x0148 to be the
same by accident.
This fixes bug 3194389.

*** w72_spritelump_type_fix
patchfile = w72_spritelump_type2.patch
- commit revision 824
Fix bug in spritelump_type patch where the signs of two hardware
render lines got changed.  (Late night, copying too much)

*** w73_missile_prep
patchfile = w72_missile_prep.patch
- commit revision 825
Cleanup of code around missile movement.
Prep for mancubus missile bug fix.

*** w73_mancubus_walls
patchfile = w72_mancubus_walls.patch
- commit revision 826
Fix bug of mancubus fireballs going through walls.
Fix bug of missiles exploding within walls instead of upon them.

*** w74_misc
patchfile = w74_misc.patch
- commit revision 829
Made extensive use of pmo = player->mo.
Added comments.
Straigtened code indentation, added some {}.

*** w74_boom_demo
patchfile = w74_boom_demo.patch
- commit revision 830
Created DemoAdapt functions to change engine settings for demos.
Fix demo code to better handle boom, prboom, demos.
Use more of the demo setup variables.
Correct the turn code to use relative turns for boom demos.
Commented more of the demo code.

*** w74_boom_demo
patchfile = w74_boom_demo.patch
- commit revision 831
Seemed to miss something on first try.

*** w74_demo144
patchfile = w74_demo144.patch
- commit revision 832
DoomLegacy demo format will have a header of version 144, and the
characters "DL".  DoomLegacy demos shall only use the one demo version number.
Three later fields shall record the DoomLegacy VERSION, demoversion,
and sub-demoversion numbers.
Not yet enabled, alpha still writes demoversion 143.

*** w74_boom_demo
patchfile = w74_boom_demo.patch
- commit revision 833
Remove duplicate code inserted by svn 831.

*** w74_sector_friction
patchfile = w74_sector_friction.patch
- commit revision 834
Changed to MBF style sector friction (from examination of Killough code in prboom),
making DoomLegacy more consistent with DoomLegacy 2.0, prboom and
other modern ports, with some fixes and differences.
Water friction and Heretic friction are also converted to sector friction.
Sectors get the friction and movefactor values at load time,
and are updated whenever a flag or friction control changes.
Finds stickiest friction on icy sector edge too.
Independent friction for each 3dfloor slab.
Old boom friction thinker code is compile-time conditional (FRICTIONTHINKER),
and is only used for demos. Demos select appropriate friction code.
Rearranged some Move and Thrust functions during the conversion.
Did not preserve perfect demo compatibility with Boom and prboom.
Moved a Heretic chicken friction calc, which may have fixed a latent bug.

*** w74_player_bob
patchfile = w74_player_bob.patch
- commit revision 835
Converted to independent player bob momentum of Killough, as in DoomLegacy 2.0,
MBF and prboom, with fixes and adaptations.
Compile-time conditional on BOB_MOM.
Fixes many problems of previous bobbing, such as bobbing while riding
conveyor, and interaction with friction.

*** w74_3dfloor_opening
patchfile = w74_3dfloor_opening.patch
- commit revision 836
Rewrite of 3dfloor opening code, simplified logic, moved redundant
tests making it faster, and fixed an error.
Old code could select floor and dropoff floor as 3dfloor slabs on same
side of line.

*** w74_monster_friction
patchfile = w74_monster_friction.patch
- commit revision 837
Monsters use same sector friction as players.
Selection mechanism for monster friction (none, MBF, momentum).
The MBF monster friction only gives the monster momentum on ice, 
and this creates surge when moving off ice, and stall when moving onto ice.
Momentum monster friction selection accumulates momentum on every move,
and fixes the surge and stall problems.
Additional code to prevent hangups on dropoff ledges, get monster
unstuck from edges, and to allow monsters to fall off conveyor belts.
Pass detection of dropoff to calling routines.
Renamed P_Move to P_MoveActor.
Tuning required months of testing and adjusting algorithms.

*** w74_adv_options_menu
patchfile = w74_adv_options_menu.patch
- commit revision 838
Create Adv Options menu, for monster friction, gravity, voodoo mode,
voodoo insta-death, and door delay.

*** w75_flip_offset
patchfile = w75_flip_offset.patch
- commit revision 840
- commit revision 842   had log, but not code patch
As suggested by Fraggle, use (width-offset) instead of offset when displaying a
sprite frame flipped.

*** w75_docs
patchfile = w75_docs.patch
- commit revision 843
Update docs for alpha3 release.

*** w76_monster_stuck
patchfile = w76_monster_stuck.patch
- commit revision 847
Fix monster momentum friction to help stuck monsters.
Must have full speed impulse for stopped monsters because some wads,
like TNT, have overlapped monster positions, and it depends upon that
vanilla behavior to get them unstuck from each other.

*** w76_z_test_notes
patchfile = w76_z_test_notes.patch
- commit revision 848
Part of the code for z_testing of monsters is disabled and it is not a
mistake.  The code existed previous to heretic code inclusion, and
heretic has similar behavior.  This documents the variables and code
that belong to the old code.

*** w76_multimenu
patchfile = w76_multimenu.patch
- commit revision 850
Reorganize the multiplayer menus.
Main menu is now compatible with original (and does not have any legacy.wad
graphics), to allow menu modifications like in Plutonia2.
Created a SingleMulti menu to select between (Single player, Two
player, Multi-player).
The two player setup has been fixed to allow setup before starting
server.

*** w76_levelname
patchfile = w76_levelname.patch
- commit revision 851
Level names for TNT and Plutonia were not displayed because they
depended upon gamemission, which was never setup.  Replaced logic
with gamedesc_id, which gives same information.
Removed gamemission.
Cleaned up some related macros and levelname functions.

*** w76_TNT_MAP30_stair
patchfile = w76_TNT_MAP30_stair.patch
- commit revision 852
TNT MAP30 depends upon a stair builder bug that was fixed by Boom.
Fix using DemoAdapt so that for TNT MAP30, it disables the Boom
stairbuilder fix (giving the original buggy code).  Sometimes the bug
increments a stair twice.  TNT MAP30 has 24 steps, but they removed some
linedefs to have only 18 steps (some of which increment by 16) because
of the bug.

*** w76_TNT_MAP31_key
patchfile = w76_TNT_MAP31_key.patch
- commit revision 853
TNT MAP31 yellow key is missing because wad has it marked as
multiplayer only.  This makes it impossible to finish the level.
This fix removes the multiplayer flag from this key, for this game and map.

*** w76_plutonia_text
patchfile = w76_plutonia_text.patch
- commit revision 854
The plutonia text was missing, and TNT text was not displayed.
Added P1TEXT .. P6TEXT.
Tried to enter the plutonia text by hand, but had errors, and had to
copy it from prdoom and plutonia2 (to get plutonia2 DEH to work).
Fixed the finaltext logic to select Doom2, plutonia, or TNT text.

*** w76_text_reorg
patchfile = w76_text_reorg.patch
- commit revision 855
Text enum names moved from d_englsh.h to dstrings.h, as they are
universal to french, english, and all languages.
Removed text[] that are not changable from DEH.  This forced
several strings with SAVEGAMENAME combined at compile-time with other
strings, to be made to combine at run-time.
SAVEGAMENAME usage also changed to handle savegame name from text[],
because it will changable from BEX.
This is in preparation for BEX text modification code.

*** w77_DEH_Init
patchfile = w77_DEH_Init.patch
- commit revision 856
Save all DEH replaced strings into deh_ vars for comparison.
This allows multiple replacements of the same string, or other name,
without mutual interference.  Because FreeDoom will contain such a DEH
lump, it would have prevented any other PWAD from using DEH to replace
the same string.  The save is performed in DEH_Init.

*** w77_DEH_strcasecmp
patchfile = w77_DEH_strcasecmp.patch
- commit revision 857
DoomLegacy and other ports changed to using strcasecmp, so that lumps
would not fail due to name case.  This changes most DEH string
comparisions to use strcasecmp.

*** w77_DEH_replace_string
patchfile = w77_DEH_replace_string.patch
- commit revision 858
A common replace_string function is created.
It performs checks against hostile strings, ensuring that replacement
strings contain only the % that the original string contained.
It blocks certain characters that are considered dangerous, and have
been used to attack programs.
It allocates the new string using malloc, instead of Z_Alloc.
Define DEH_RECOVER_STRINGS, enables the testing of strings
for being const or malloc, and recovery of malloc memory.

*** w77_BEX_flags
patchfile = w77_BEX_flags.patch
- commit revision 859
Add BEX flag by name.  There is a conflict between MF_TRANSLUCENT
which is defined in doomdeh.txt, and MF_FLOORHUGGER which is not.

*** w77_translucent
patchfile = w77_translucent.patch
- commit revision 860
Fix the conflict between MF_TRANSLUCENT and MF_FLOORHUGGER.
Change MF_FLOORHUGGER to MF2_FLOORHUGGER.
Adds logic to distinguish between them in old DEH patches.
Fixes translucent code to be affected by BEX changes to MF_TRANSLUCENT.
Change translucent to a table.
Added PACKED_ATTR define so that table can be packed.

*** w77_action
patchfile = w77_action.patch
- commit revision 861
Separated action function declares from info.c into new file action.h, so
they can be used in dehacked.c too.

*** w77_BEX_file
patchfile = w77_BEX_file.patch
- commit revision 862
Main body of BEX text, pointer, processing.
Recognizes [STRINGS], [POINTER], [PARS], and BEX include.

*** w77_par_time
patchfile = w77_par_time.patch
- commit revision 863
Fix par logic to test for BEX modifications, and to display PAR time
only when such PAR times are valid.
Change SUCKS for non-id-games to have a limit of 24 hours, so
the player can see their time.

*** w77_devgame
patchfile = w77_devgame.patch
- commit revision 864
Check -devgame parameter for valid <name>, before using it, preventing
segfault.

*** w77_french
patchfile = w77_french.patch
- commit revision 865
Convert d_french.h to a run-time replacement of text[] strings, after
DEH has made a copy.  Now FRENCH can be used with DEH string replacement.
There are functions to replace non-game strings, and game strings
separately, and functions for heretic and chexquest strings.
There are calls at the appropriate places in d_main.c.
The d_french.h file has many new strings that need translation.

*** w77_BEX_language
patchfile = w77_BEX_language.patch
- commit revision 866
Added BEX_LANGUAGE option that loads a BEX file to replace all strings
in text[].  This more limited in the strings it can reach, but the bex
file can be changed for any language without compiling the source.
It accepts a parameter  -lang <name>, where <name> can be any language
name (i.e. french, german, etc.).  It will form a filename, french.bex,
and attempt to process it.  If <name> is blank, or if
BEX_LANGUAGE==AUTO, is selected, it will use the default, "lang.bex".
Changed BEX to also accept strings with double quotes.
The french.bex file has many new strings that need translation.

*** w77_action_french_files
- commit revision 867
Add action.h and lang_bex/french.bex to the svn system.

*** w78_help_docs
patchfile = w78_help_docs.patch
- commit revision 868
Update legacy.html with correct installation instructions, fix errors.
Improve -help command line switch.
Add a -v switch for verbose, and use it to print out more information.

*** w78_max_wadpath
patchfile = w78_max_wadpath.patch
- commit revision 869
Use MAX_WADPATH for almost all file path string manipulation.
Add cat_filename function to encapsulate proper file name concatenation.
Protect filename strings against extra long strings in command line, wad,
and config files.
Harden many string operations against buffer overflow.

*** w78_net_playdemo
patchfile = w78_net_playdemo.patch
- commit revision 870
Update some net functions to use ptrs instead of repeating array
indexing.
Harden a net buffer string operation against buffer overflow.
Fix DeferredPlayDemo function, to put command in Execute as one
string, so it does not execute partial strings and fail.

*** w78_win32_compile
patchfile = w78_win32_compile.patch
- commit revision 871
Additions to Makefile to support compilation on Win98 using MinGW.
Create /dep file to hold *.dep files outside of source code.
Change to WIN32 GlobalMemory lib call that is present on Win98.
Fix dehacked.c problems with compiler not likely unsigned char in lib calls.
Allow underline in dehacked/BEX names.
Some other gcc 4 compiler complaints fixed.

*** w78_execute_config
patchfile = w78_execute_config
- commit revision 872
Execute of config file on window systems fails because the COM buffer
system mangles windows path backslashes.  Extensive fixes to COM
buffer handling to prevent this, by distinguishing script commands and
those commands that have filename parameters.

*** w78_com_args
patchfile = w78_com_args.patch
- commit revision 873
Update COM buffer execution interface.
The COM_args function is unused.
Added COM_Args function that returns count and first 4 com parameters.
This makes for fewer calls, converts calls into literal array access.

*** w78_command_files
patchfile = w78_command_files.patch
- commit revision 874
Make doomwaddir, legacyhome, config file strings hardened against
windows no having environment variables.
Will now search two possible doomwaddir names before trying current
directory.
No longer allows current directory to be "" string, as that results in
save and config files being put into root directory.  Will copy the
current directory string instead and use only absolute paths.
Doomwaddir code and config file code moved and organized together.

*** w78_nosound
patchfile = w78_nosound.patch
- commit revision 875
The nosound variable name conflicts with a Watcom support function.
The support function really ought to be named better, but cannot fix
that.  Rename nosound, to nosoundfx, as sure fix.
Watcom compilation still has other problems.

*** w78_blockmap_mem_corrupt
patchfile = w78_blockmap_mem_corrupt.patch
- commit revision 876
With a missing or bad blockmap in the wad, the code will corrupt
Zone memory block headers.
Add checks for the missing blockmap, and overruns of the blockmap
allocation.
Add more complete ZONEID checking (some as PARANOID) and better reports to the
Zone memory functions.

*** w78_video_misc
patchfile = w78_video_misc.patch
- commit revision 877
Comment video setup functions, so they are more understandable.
Straighten video menu switch, unnecessarily complicated.

*** w78_whatsnew
patchfile = w78_whatsnew.patch
- commit revision 878
Update legacy.html and whatsnew.html docs to svn877.

*** w78_Make_win32
- commit revision 879
Doc file on how to make DoomLegacy on Win32 system.

*** w79_duplicate_symbols
patchfile = w79_duplicate_symbols.patch
- commit revision 881
Working on Mac has revealed that our linker is not showing us duplicate
symbols and is combining them.
Added linker flag to give warning when duplicate symbol.
Fixed some vars that should be static.
Fixed some header variable declares that were not extern.

*** w79_deh_flags
patchfile = w79_deh_flags.patch
- commit revision 882
The previous BEX code really messed up the DEH flags code, such that in phobiata
the player could not slide along the walls.
This fixes the DEH and BEX flags logic so that DEH changes only the
flags it intends to and clears flag2 bits (like MF2_SLIDE) only when it
shows that it is changing flag2 bits.

*** w79_deh_text
patchfile = w79_deh_text.patch
- commit revision 883
Some text strings got changed (DOS -> your os) and now DEH cannot
recognize them.  This adds a hashed lookup that can recognize strings
that we no longer have, and point DEH at the right string.
It also is used by chex newmaps.c to recognize ult doom strings after
the chex modifications have changed all the strings.
Chex also changed some strings with two %s, to have one %s, and Newmaps
wants to change it back to two %s.  The %s counting method would not
allow this, so a new explicit table had to be created.

*** w79_demo_ctrl
patchfile = w79_demo_ctrl.patch
- commit revision 884
Fix the demos so they stop interfering with savegame loading.
The screen would wipe, and then wipe a second time and the controls
would be useless.
Created a new contol var, demo_ctrl, that stops demos once a savegame
has been loaded, and does the advance demo job too.  It replaces advancedemo.

*** w79_demo_friction
patchfile = w79_demo_friction.patch
- commit revision 885
Attempt to fix demos to record and honor monster friction settings.
Older demos need to use MBF monster friction or Doom no friction.

*** w79_save_limit_99
patchfile = w79_save_limit_99.patch
- commit revision 886
Prevent savegames over 99.  Would crash on load.
Was missing explicit check.

*** w79_jumpgravity
patchfile = w79_jumpgravity.patch
- commit revision 887
JUMPGRAVITY is variable by fragglescript, no longer a macro.
Change it to jumpgravity.

*** w79_team_name
patchfile = w79_team_name.patch
- commit revision 888
Fix segfault when command "teamplay 1".
Team_name[] was array of ptrs to const strings, and the const strings
cannot be written.  Created basic team structure, with name.
Only basic functions for team name for now, but can become a dynamic list.

*** w79_deathmatch_spawn
patchfile = w79_deathmatch_spawn.patch
- commit revision 889
Fix bug 1095897.
Players spawn in deathmatch on other players, and get locked.
Tests for this were in code, but failed because player corpse does not have
MF_SOLID set, thus things check was skipped.
Must temporarily set MF_SOLID to do CheckPosition test.
Changed player corpse to honor cv_solidcorpse setting.
Set MF_SOLID on solid player corpse.

*** w79_FIXED_MAX
patchfile = w79_fixed_max.patch
- commit revision 890
Use of MAXINT on 32 bit fixed_t variables is not safe on 64 bit machines.
Define a FIXED_MAX and FIXED_MIN that are used as the max and min
of fixed_t variables.
These can be maintained according to the size of fixed_t.
Change all used of MAXINT with fixed_t vars to use FIXED_MAX and FIXED_MIN.

*** w79_spec_enum
patchfile = w79_spec_enum.patch
- commit revision 891
Most enum names in spec.h look like variable names.
Give them prefixes.

*** w79_lowest_ceiling
patchfile = w79_lowest_ceiling.patch
- commit revision 892
Search for lowest ceiling was flawed by an additional paranoid test that
would also defeat a Boom search limit meant to prevent overflow.
Removed the additional paranoid test.
Tuned other sector floor and ceiling height searches to execute faster,
as they were using n! passes of the thing list.

*** w79_floor_up
patchfile = w79_floor_up.patch
- commit revision 893
Fix bug 0585154.
In Doom2 Map05, two doors to secret rooms will not work.
If another door (1st of 4 doors on left) is opened first, then tag 9
will move the floors of these two rooms like doors.
Checks against hitting something had been made conditional on 3D floors,
for some reason.  Restoring these tests stopped the floors movement
like the original, and the flawed Map05 is then still playable.
Must be careful to not have problem with Doom2 Map06, with the spider
demon in the crusher.  Some possible tests would freeze the crusher if
something was stuck in the ceiling or floor.
This is enabled by COMPAT_FLOOR_STOP, for now.

*** w80_vid_defs
patchfile = w80_vid_defs.patch
- commit revision 894
Revise vid structure to handle problems with MAC and direct video.
The driver sets up the display and screen size according to its
characteristics.
The buffer width can be different than the screen width, to handle the
Mac which pads it buffer lines to a power of 2.
The driver can control the video buffer width independently of the
screen buffer width, neither of which need to match the screen width.
Contains fields that are multiplied by the buffer width.
Fixes many common draw routines to increment by buffer width instead of
screen width so they are correct for any driver buffer choice.
Fixes uses of bpp as byte to be bytepp, as bpp is bits-per-pixel.
Introduces the controls for DRAW8PAL, DRAW15, DRAW16, DRAW24, DRAW32.

*** w80_vid_port_fixes
patchfile = w80_vid_port_fixes.patch
- commit revision 895
Minimal fix of djgppdos, linux_X, macos, os2, sdl, win32, port drivers for
the new vid structure.  This is a temporary fix, as they need to be rewritten.

*** w80_vid_control_fixes
patchfile = w80_vid_control_fixes.patch
- commit revision 896
Fixes for new vid structure, to use drawmode, and buffer line sizes in
many draw routines.
Introduces code that uses drawmode to select bpp drawing, instead of
testing bpp.
Changes borderpatch to borderflat, as it is not a patch that is drawn.
Changes setmodeneeded to use -1 as inactive, instead messing with
changing 0.. to 1.. everywhere.
Saves true bpp to config, instead of some hacked value.
Fixes am_map, d_main, f_wipe, m_menu, r_data, r_draw, screen,

*** w80_video_fixes
patchfile = w80_video_fixes.patch
- commit revision 897
Code has not used dirty rectange limited drawing since DOS.
Disable Mark_Rect function and calls using DIRTY_RECT macro.
Introduce ENABLE_DRAW15, ENABLE_DRAW16, ENABLE_DRAW24, ENABLE_DRAW32
macro controls in doomdef.h for conditional draw code.  User can disable
compiling drawing code for modes they cannot use.
Introduce pixel structures for 24bpp, and 32bpp.
Introduce color translation table, color8, that works for all draw
modes, replacing color8to16.  Init it when screen bpp is determined.
Fix draw16 to use uint16_t instead of short.
Introduce basic draw functions, V_GetDrawAddr, V_DrawPixel, V_DrawPixels,
that work in all bpp draw modes, for use in splash screens, wipes, and
the like.
Fixed V_CopyRect, VID_BlitLinearScreen, V_DrawMappedPatch,
V_DrawScaledPatch, HWR_DrawSmallPatch, V_DrawTranslucentPatch,
V_DrawPatch, V_BlitScalePic, V_DrawFill, V_DrawFlatFill,
V_DrawFadeScreen, V_FadeConsBack, to draw correctly using buffer width
and drawmodes.
Update V_DrawTiltView and V_DrawPerspView in similar fashion,
but they have other serious problems.
Diabled V_DrawBlock and V_GetBlock because they were not safe for use
on screens with extended draw modes,
and substituted other existing draw routines for the uses.

*** w80_map_con
patchfile = w80_map_con.patch
- commit revision 898
Fix draw of auto map for all draw modes, using V_DrawPixel.
Fix draw of CON_DrawBackPic for all draw modes, using V_GetDrawAddr
and V_DrawPixel.
Fix draw of D_PageDrawer for all draw modes, using V_DrawPixels.

*** w80_finale_init
patchfile = w80_finale_init.patch
- commit revision 899
Fix draw of finale screens, for all draw modes, using V_DrawPixel.
Fix screenshot to use correct buffer widths, but it is still limited to
8bpp mode because of the save format.
Fix fuzz init, and ylookup init, for all draw modes.
Fix R_FillBackScreen, R_DrawViewBorder, for all draw modes, using V_DrawPixels.
Fix wi_stuff, for all draw modes.

*** w80_wipe
patchfile = w80_wipe.patch
- commit revision 900
Change wipe functions to not pass parameters they do not use, and also
fix them for all draw modes.
Remove ColMajorXForm transform, as it was not really faster, and
was limited to 8bpp, now using a simple pixel copy.
Created a proportional fade for the extended draw modes, which is not
as smooth as the 8bpp translucent tables, but gives similar function.
Reorganized strange wipe control table for simpler access.

*** w80_request_bpp
patchfile = w80_request_bpp.patch
- commit revision 901
Introduce new command line switches and common control structure, so that
each port driver does not do this in a unique way.  The port drivers now
react to the common control variables.  Most old control variables
declared in the port drivers, such as rendermode, vidwait, fullscreen,
have been moved to video.c.
A new V_Init_VideoControl, now registers common controls.
A new V_CanDraw, returns true when a bpp can be drawn.
Set req_drawmode according to command line requested drawmode.
Switch "-highcolor", now sets REQ_highcolor (request a 15 or 16 bpp mode).
Switch "-truecolor", sets REQ_truecolor (request a 24 or 32 bpp mode).
Switch "-native", sets REQ_native, which requests use of the native
drawing mode.
Switch "-bpp 15", sets req_bpp and REQ_specific, which requests a
specific bpp mode (can be 8, 15, 16, 24, or 32).
Fixes DrawPixel routines to use direct ptr access to pixels, which
should give the fastest code.

*** w80_draw16_minimal
patchfile = w80_draw16_minimal.patch
- commit revision 902
Fixed draw16 routines to give minimal functionality.
Fixed translucent draw using proportional addition of pixels.

*** w80_sdl_port
patchfile = w80_sdl_port.patch
- commit revision 903
Extensive rewrite of mode code in sdl port driver.
It now handles all bpp mode requests.
I_StartFrame no longer locks the video buffer, because that needs to be
kept to a minimal time, during I_FinishUpdate.  This is dictated by
SDL specs.
VID_PrepareModeList merged into I_StartupGraphics.
Use of SDL_GetVideoInfo made useful (instead of bypassed).
Created VID_SetMode_vid to do actual mode setting, to reduce
duplicated effort.
Extensive video reporting using verbose switches "-v" and "-v2".

*** w80_testbpp
patchfile = w80_testbpp.patch
- commit revision 904
Adds a command line switch "-testbpp", that forces the bpp requested to
succeed.  The hardware actually uses the native bpp and converts the
drawn bpp in I_FinishUpdate.  This is meant for test and development of
the extended bpp draw modes, when matching hardware is not available.
This code is conditional on the TESTBPP macro, and only exists in
sdl/i_video.c at this time.

*** w80_draw16_ext
patchfile = w80_draw16_ext.patch
- commit revision 905
Moved common draw routine from r_draw8.c to r_draw.c.
Fixed r_draw8.c to use ybytes instead of width.
Added translucent_index variable and field because translucentmap ptr
only worked for palette based drawing.
Fix r_draw16.c so that 15 and 16 bpp draw functions work.
Create new draw functions for those that were missing.
Create transparent and fog effects using shift and add of 15 and 16 bpp pixels.
Has many alternative code sections for further experimentation.

*** w80_fade16
patchfile = w80_fade16.patch
- commit revision 906
Fix screen fade effects for 15/16 bpp drawing.

*** w80_testbpp_8
patchfile = w80_testbpp_8.patch
- commit revision 907
Explicit reject of -bpp 8 -testbpp.

*** w80_r_draw
patchfile = w80_r_draw.patch
- commit revision 908
Makefile must compile r_draw.c anytime any r_draw8.c, r_draw16.c,
r_draw24.c or r_draw32.c is modified.
Add empty r_draw24.c and r_draw32.c.
Fuzztable offsets needed to be multiple of pixel size.

*** w80_SDL_video_error
patchfile = w80_SDL_video_error.patch
- commit revision 909
Fixes SDL port driver so that StartupGraphics does not return unless
has valid video mode and display.  Print appropriate error message to
stderr.

*** w80_draw_endian
patchfile = w80_draw24_endian.patch
- commit revision 910
Fix DrawPixel for big endian machines.

*** w80_draw_24bpp_create
patchfile = w80_draw24_create.patch
- commit revision 911
Create functions for DRAW24 mode.
Fill in functions in r_draw24.c and other support.
Improved fog.
Not fully optimized.

*** w80_draw_32bpp_create
patchfile = w80_draw32_create.patch
- commit revision 912
Create functions for DRAW32 mode.
Fill in functions in r_draw32.c and other support.
Not fully optimized.

*** w80_green_console
patchfile = w80_green_console.patch
- commit revision 913
Fix green console to be more readable and not distort colors in 15..32 bpp.
Add GREEN_TINT_255 control, set to 0x16.
Dim background to 25% for higher contrast (gray green).

*** w80_fade_32
patchfile = w80_fade_32.patch
- commit revision 914
Fix fade effects for 24/32 bpp drawing

*** common/colortst.wad
- commit revision 915  by wesley johnson
colortst.wad update for fog effects

*** w80_background_border_32
patchfile = w80_backborder32.patch
- commit revision 916
Fix background border not filling screen in DRAW32 and other video
modes.  Needed to multiply side size by bytepp.

*** w80_video_init
patchfile = w80_video_init.patch
- commit revision 917
Change V_Init to V_Init_Draw, and make it responsible for setup of
draw variables for DrawPixel and other v_video draw routines.
Have it make needed palette (palette was missing during intro screens).

*** w80_linux_xshm
patchfile = w80_linux_xshm.patch
- commit revision 918
Update linux xshm to latest interface and improve code.
Can handle drawing in -native bpp mode, -highcolor, -truecolor modes, and
using -bpp.
It will setup direct draw to the image buffer using native bpp (-native).
This does not change the hardware bpp, nor the previous method of leaving the
hardware bpp at the system setting, and converting our 8bpp draw buffers to it.
Changing hardware bpp is possible, I just cannot find the docs at this time.

*** w80_linux_ggi
patchfile = w80_linux_ggi.patch
- commit revision 919
Update linux ggi to latest interface and improve code.
Can handle drawing in -highcolor, -truecolor modes, and using -bpp.
Will change hardware bpp.
Does not detect native bpp.
This has not been test compiled as I do not have ggi libraries.

*** w81_cleaning
patchfile = w81_cleaning.patch
- commit revision 920
Fix comments, add {}, remove dead code and obsolete commented out lines.
Align code.
Cleanup some messy code arrangements to cleaner equivalent.
Rename enum items cl_ to CLM_.
Rename SendRam to SendData.
Rename enum freemethode_t with SF_ to enum TAH_e with TAH_,
because of confusion with other enums, and gave the enum more descriptive names.
Make KICK defines into an enum kick_msg_e.
Rename enum filestatus_t to filestatus_e.
Rename fwriteshort to fwrite16, fwritelong to fwrite32.

*** w81_Doom2Map8
patchfile = w81_Doom2Map8.patch
- commit revision 921
Missing break stmt in switch stmt.
Doom2 Map8 is dropping into secret level code,
even though it is not a secret level.

*** w81_pain_skullspawn
patchfile = w81_pain_skullspawn.patch
- commit revision 922
Fix bugs and irritations in pain elemental, skull spawning.
Skull limit code made conditional on demoversion, using EN_skull_limit.
Pain elemental skull spawning made conditional using EN_old_pain_spawn.
Checks added for skulls and pain elementals attacking dead monsters,
may not be needed, but will test.
Formally init target and tracer ptrs in mobj.

Fixed skull spawning using a version of Boom code that checks on line
crossings.  Partial checking code already present was rewritten into
P_CheckCrossLine.
Skulls no longer spawn into void walls.

Pain elementals fixed so if there is not room to spawn skull, it silently
removes the skull instead of sending it down to floor to explode.
Conditional code is present for:
(REMOVE) remove skull (like Edge) (currently selected),
(KILL) explode in place (like prboom) (disabled),
(DAMAGE) which causes it to explode on floor (previous Legacy) (disabled).

*** w81_savegame_buffer
patchfile = w81_savegame_buffer.patch
- commit revision 923
Fix for bug_3442118, where Hell Ground wad (hg.wad) map04 will overrun
the savegame buffer.
Increased the reserved free space from 2K to 4K, and the header buffer size.

*** w81_fogsheet
patchfile = w81_fogsheet.patch
- commit revision 924
Fogsheet improvements.
Drawing routines for fog sheet with shifting effects, using mid texture.
Mid texture determines the color of the fog, and the intensity of the
shifting pattern.
Fog is not finished.

*** w81_Boom_translucent
patchfile = w81_Boom_translucent.patch
- commit revision 925
Fixed Boom translucent linedef 260.
Tagged lines now get the translucent effect too.
Recognizes and uses named translucent lumps introduced by linedef 260.
Analyzes Boom translucent lumps to get alpha for DRAW15, DRAW16,
DRAW24, DRAW32, and opengl draw modes, which now work.
Will draw using closest existing translucent implementation, or use
analyzed alpha.
Added TRANSLU_75 in RGB draw routines, to implement a 75/25% translucent draw.
OpenGL does draw the translucent textures in BOOMEDIT.WAD,
but does not draw other transparent textures behind the closest one.
OpenGL also fails to draw transparent over the switches in hg.wad,
due to unknown causes.

*** 
- commit revision 926
Add files r_draw24.c, r_draw32.c, which were missing.

*** w81_Boom_colormap
patchfile = w81_Boom_colormap.patch
- commit revision 927
Boom deepwater colormap fixed.
Effect menu has selections for Boom Deepwater colormap effect:
Sector colormap (Boom colormap behaves same as Legacy colormaps),
Boom visible colormap (where colormap is visible like in legacy),
Boom colormap (where the colormap is not visible like in Boom),
and Boom detect (which adjusts according to detected Boom and Legacy linedefs).
The Boom colormap selections make the Boom deep water sectors appear
normal until walked into, then the deepwater colormap will have global effect.

*** w81_Boom_pusher
patchfile = w81_Boom_pusher.patch
- commit revision 928
Gave the Point pusher a square law effect (enabled by mbf_support),
as in prboom (an MBF feature actually, Boom is not square law).

*** w81_door_thinker_check
patchfile = w81_door_thinker_check.patch
- commit revision 929
Derived from prboom fixes doc (cph 2001/04/05).
Doom bug: cannot raise a door when ceiling action is in same sector.
Add check to door logic that ceiling action being modified is a door action.
This also prevents corruption of the ceiling action.

*** w81_wad_to_angle
patchfile = w81_wad_to_angle.patch
- commit revision 930
Note prboom fix doc (cph 2001/04/05), of Vanilla Doom bug found by Ville Vuorinen.
Signed mapthing_t angle would create table lookup using negative index.
Fix uses new func, wad_to_angle(), to isolate the signed wad field, from
unsigned angle_t usage.
It does not emulate the Doom buggy behavior.

*** w82_colortst_wad
wads/colortst.wad
- commit revision 931
Fog sheets

*** w82_bex_frame
patchfile = w82_bex_frame.patch
- commit revision 932
Fix strcmp error in BEX parsing of FRAME and PARS.
Fixes hg.wad, eye shooting missiles.

*** w82_hw_translucent_order
patchfile = w82_hw_translucent_order.patch
- commit revision 933
Fix hardware render to draw translucent in distance order.
This fixes BOOMEDIT.WAD.

*** w82_hw_Boom_colormap
patchfile = w82_hw_Boom_colormap
- commit revision 934
Boom deepwater colormap fixed in hardware renderer.
Extend view_colormap to affect hardware render too.

*** w82_get_gl_info
patchfile = w82_get_gl_info.patch
- commit revision 935
Bug 3419447.
Fix buffer overrun of DBG_Printf strings by video card extensions.
Create common function, Query_GL_info(), to get GL info strings,
check renderer, and set gl_extensions string and oglflags.
Create DBG_Print_lines() function to print extension strings on multiple
lines, and prevent buffer overrun.
Change SDL, Win32, X11 opengl port drivers, to use these functions.
In DBG_Printf(), when verbose, print to stderr too;

*** w82_CONS_Printf_va
patchfile = w82_cons_printf_va.patch
- commit revision 936
Fix buffer overruns caused by vsnprintf to buffer without string termination.
Create function CONS_printf_va() to handle va_list printing to console.
This replaces multiple copies of print buffers and vsnprintf.

*** w82_hw_obj_colormap
patchfile = w82_hw_obj_colormap.patch
- commit revision 937
Fix hardware render so that colormaps affect objects too.
Fixed HWR_RenderPlane to have colormap parameter, so can pass in floor
and ceiling colormaps, same as in software renderer.

*** w82_hw_StoreWall_float
patchfile = w82_hw_StoreWall_float.patch
- commit revision 938
Change HWR_StoreWallRange to have float operands.  Part of the code
treated them as 0.0 to 1.0, and part was integer like the software
renderer.
General spelling fixes, replace some stub decl with proper include.

*** w83_filestatus_e
patchfile = w83_filestatus_e.patch
- commit revision 939
Fix filestatus_t stragglers to be filestatus_e.

*** w83_get_gl_info_char
patchfile = w83_gl_info_char.patch
- commit revision 940
Fix get_gl_info for (char*) type warnings on newer compilers.

*** w83_fs_linetrigger
patchfile = w83_fs_linetrigger.patch
- commit revision 941
Condense some of the door, switch, and other line trigger code.
Fix some floor and switch code to detect incomplete fragglescript
created linedefs (no sidedefs, no frontsector),
and skip secondary actions that would have segfault.
Fix fragglescript to init more fields in temp linedef to some safe
value.
Fixes win32 crash on fragglescript teleport, per Bug 3185357.

*** w80_win32_vid_fixes
patchfile = w80_win32_vid_fixes.patch
- commit revision 942
This is not in order, was in the w80 patch series, but did not get commit.
Minimal fix of win32 port drivers for the new vid structure.
This is a temporary fix, as they need to be rewritten.

*** w83_draw32_remove_printf
patchfile = w83_draw32_remove_printf.patch
- commit revision 943
Remove a debugging printf that is in svn, but not in my working files.

*** w83_num_skincolor
patchfile = w83_num_skincolor.patch
- commit revision 944
Change MAXSKINCOLORS to NUMSKINCOLORS, which is how it is used.
Moved in doomdef as it is dependent upon code, not a setting.
Caused confusion in understanding code.

*** w83_fs_func_safety_checks
patchfile = w83_fs_func.patch
- commit revision 945
General cleanup on all fragglescript functions.
Move error code to after return, for speed.
Added many checks for valid mobj and fields that could segfault in fragglescript.
Fixed much of fragglescript code fragility.
There is a compile-time var, OLDBEHAVIOR, that disables some fixes
that would change some details of fragglescript behavior.  It is
assumed that no scripts depend upon these details, but the switch is
included for debugging.  Phobia and hth2 were tested and seem unaffected.
Changed fixedvalue to access int arg directly, which saved 6K in code.
Added comments.

*** w83_fs_op
patchfile = w83_fs_op.patch
- commit revision 946
General cleanup on all fragglescript operations.
Move error code to after return, for speed.
Added comments.

*** w83_fs_func_old
patchfile = w83_fs_func_old.patch
- commit revision 947
Remove OLDBEHAVIOR code in fragglescript functions.

*** w83_makefile
patchfile = w83_makefile.patch
- commit revision 948
Move OBJ of an interface to that interface makefile section.
Made WIN32 interface compilable (which uses different names than the
others).
Removed strange i_cdmus_o var.
Created MAINOBJ var.
Moved linux_x common OBJ (in xshm and ggi) to a common OBJ assign,
leaving only the video.

*** w83_cdmus_optional
patchfile = w83_cdmus.patch
- commit revision 949
Make CD-music a makefile compile option.
Setting CDMUS (default is CDMUS=1) in the makefile enables compiling CD
music code.  Without CDMUS, all CD code is removed, including cd-volume
controls.  This allows compiling without some special libraries, that
some interfaces require.
To override default, use NOCDMUS on the make command line, or edit
makefile.
> make NOCDMUS=1

*** w83_fs_array_camera_spec
patchfile = w83_fs_array_spec.patch
- commit revision 950
General cleanup on fragglescript array functions,
camera functions, and spec functions (if, elseif, while, for).
Move error code to after return, for speed.
Added comments.

*** w83_fs_script_parse
patchfile = w83_fs_script_parse.patch
- commit revision 951
General cleanup on fragglescript script and parse functions.
Move error code to after return, for speed.
Added comments.

*** w83_fs_func_doc
patchfile = w83_fs_func_doc.patch
- commit revision 952
Update the fragglescript function docs to the actual code
implementation.
Fix some comments in the code.

*** w83_wipe24
patchfile = w83_wipe24.patch
- commit revision 953
Fix wipe for 24bpp draw.  One index was not using bytepp.

*** w84_palette24
patchfile = w84_palette24.patch
- commit revision 954
Make color8_translate palette used by draw15, draw16, draw24, draw32,
respond to gamma settings, and palette changes, such as palette flash,
object pickup, damage red.

*** w84_ouchface
patchfile = w84_ouchface.patch
- commit revision 955
Previous ouchface fix was not complete.
Needed to set face priority to 8, to keep the ouchface visible for
more than one tic.
Self-damage code also needed ouchface fix.
Ouchface has mouth open wide, "ahhhh".

*** w84_compressed_patch
patchfile = w84_compressed_patch.patch
- commit revision 956
Fixes the patch combiner to handle compressed patches (which share some
of the patch columns).  It under-estimated the new size so it did
not allocate enough space for the combined patch, which causes it to
abort into using the picture format instead.
This fixes the elevator railings (SW1COMM) in Requiem.wad MAP08,
which use compressed patches.

*** w84_bob_spawn
patchfile = w84_bob_spawn.patch
- commit revision 957
An attempt to clear the player bob at spawn.
Remove some old commented out code.

*** w84_IPX_option
patchfile = w84_IPX_option.patch
- commit revision 958
Make IPX network code optional by a define in doomdef.
Makes all IPX code conditional on USE_IPX.
Enabled by default for those that have IPX headers.
This fixes bug in OpenBSD that does not have IPX, but where a specific
test is not in place.

*** w84_whatsnew
patchfile = w84_whatsnew.patch
- commit revision 959
Update whatsnew doc to current patch level.

*** w85_colormap_gen
patchfile = w85_1_colormap_gen.patch
- commit revision 960
Tune the legacy linedef colormap generate.
The wad alpha of 'a' to 'z' is now converted to 0..255 internally,
to avoid losing alpha intensity to conversion roundoff.
Fixed the drab color of hardware-render at high alpha caused by wrong
alpha conversion calc.

*** w85_mouse
patchfile = w85_2_mouse.patch
- commit revision 961
Rewrite of mouse handling, providing relative mouse motion like many other
ports use for SDL, and fixing the WarpMouse code in the absolute mouse motion
that we have been using.
Grabinput has been restored and made to work.
Provides option selection for grabinput.
Provides SDL port with selection for mouse relative or absolute.
Fixes OpenBSD mouse problem of bug/patch 3547682.
OpenBSD reports mouse motion x and y as separate events.  In DoomLegacy
later mouse motion events in a frame overwrote previous motion.  Mouse events
are now added (like Legacy2 and other ports examined).

*** w85_opengl_mode
patchfile = w85_3_opengl_mode.patch
- commit revision 962
SDL OpenGL is not switching video modes at all.
In my previous sdl rework, I forgot opengl video mode switch.
This fixes opengl video mode switch similarily to the others, and it now
switches video modes.

*** w85_statusbar_overlay
patchfile = w85_4_statusbar_overlay.patch
- commit revision 963
The statusbar and overlay were not positioned correctly in OpenGL.
The statusbar is now consistent for all video modes.
This fixes the overlay to use fdupy instead of dupy.

*** w85_secnode_freed
patchfile = w85_5_secnode_freed.patch
- commit revision 964
A previous patch in w79, sped up P_CheckSector, but made it vulnerable
to a second thing being removed by the player on a moving lift,
resulting segfault.  Removed the vulnerable nxt_ns ptr.
Instead, when test determines that secnode was freed then resort to
previous behavior of restarting from beginning of touching_thinglist.

*** w85_fixedcolormap
patchfile = w85_6_fixedcolormap.patch
- commit revision 965
Fix bug introduced by BOOM_COLORMAP, which segfaults when restoring
game saved during use of fixed_colormap.

*** w85_heretic_SWITCHES
patchfile = w85_7_heretic_switches.patch
- commit revision 966
Allow Heretic and Blasphemer PWAD to fully use the SWITCHES lump without
restricting it to only episode 4.
Other ports do not have any restriction on Heretic use of the SWITCHES entries.
Requested by a Heretic wad project.
Check for missing switch textures and default to use texture 1.

*** w86_viewer_colormap
patchfile = w86_1_viewer_colormap.patch
- commit revision 968
Make some BOOM_GLOBAL_COLORMAP code non-optional, for use with fog and
other colormaps.
Shortened some of the Boom Colormap Option text strings so they fit
low-res screens.  This affects saved configs.
Move BSPVIEWER code to r_main and make it non-optional.
Add test for colormap fog using viewer_extracolormap.  This is not
very good fog but at least it works now as documented.

*** w86_FF_cleanup
patchfile = w86_2_FF_cleanup.patch
- commit revision 969
Reorganize the FF_flags to be understandable, and easier to test, and
to not hide important relationships.
FF_RENDERSIDES -> FF_OUTER_SIDES
FF_INVERTSIDES && FF_RENDERSIDES -> FF_INNER_SIDES
FF_ALLSIDES && FF_RENDERSIDES -> FF_OUTER_SIDES | FF_INNER_SIDES
FF_RENDERPLANES -> FF_OUTER_PLANES
FF_INVERTPLANES && FF_RENDERPLANES -> FF_INNER_PLANES
FF_BOTHPLANES && FF_RENDERPLANES -> FF_INNER_PLANES | FF_OUTER_PLANES
FF_RENDERALL -> FF_OUTER_SIDES | FF_OUTER_PLANES
FF_CUTLEVEL -> FF_CUTSOLIDS | FF_CUTEXTRA
FF_DOUBLESHADOW -> FF_SLAB_SHADOW
Rework the BSP Fake floor code to be understandable.
Change BSP ffloor to ffplane, because it tracks planes, and there are
too many ffloor references in the code that have other meanings.
ffloors -> ffplane
numffloors -> numffplane

*** w86_Glide_types
patchfile = w86_3_Glide_types.patch
- commit revision 970
Cleanup hardware typenames and structs.  Change to use uint32_t and uint16_t.
GlideMipmap_t -> Mipmap_t
GlideTexture_t -> MipTexture_t
GlidePatch_t -> MipPatch_t

*** w86_HWR_types
patchfile = w86_4_HWR_types.patch
- commit revision 971
Use type names xxx_t, and "typedef struct" in hardware struct defines.
FColorARGB -> ARGB_t
FRGBAFloat -> RGBA_float_t;
F2DCoord -> v2d_t;
FTransform -> FTransform_t
v3d_t, wallVert3D, FOutVector -> vxtx3d_t  (combined type, no more copy)
EPolyFlags -> PolyFlags_e
ETextureFlags -> TextureFlags_e
ESurfFlags -> SurfFlags_e
FSurfaceInfo -> FSurfaceInfo_t
hwdspecialstate_t -> hwd_specialstate_e
hwdfiltermode -> hwd_filtermode_e
TGAHeader, *PTGAHeader -> TGAHeader_t

*** w86_5_misc
patchfile = w86_5_misc.patch
- commit revision 972
Cleanup some code to not have so many return stmts, code should exit
through only a few return stmts.
Cleanup unused functions and redirected functions.
R_GetFlatNumForName -> R_FlatNumForName  (like R_TextureNumForName)
P_FlatNumForName -> P_AddLevel_FlatNumForName (unused)

*** w86_hw_cache
patchfile = w86_6_hw_cache.patch
- commit revision 973
Cleanup of code in hw_cache, concerning bytepp, endian issues,
and much better draw code for the various bytepp switches.

*** w86_drawflags
patchfile = w86_7_drawflags.patch
- commit revision 974
Add drawflags and appropriate TF_ flags to hw_cache parameters so that do not
have global draw cache modifiers.

*** w86_hw_fx1
patchfile = w86_8_hw_fx1.patch
- commit revision 975
Fix hardware draw of fx1 translucent.
Fixes display of linedef 288 in opengl.

*** w86_hw_view_colormap
patchfile = w86_9_hw_view_colormap.patch
- commit revision 976
Fix the hardware draw of Boom and view_colormap.
Now see global colormap change with Boom deep water and colormap fog
in opengl mode.

*** w87_mobj_subsector
patchfile = w87_1_mobj_subsector.patch
- commit revision 977
Fix segfault in dsv4.  When wrong buttons are pressed player is hurt.
If they are pressed after getting the yellow key, then segfault.
There is a mobj without a subsector, and script code must check first.

*** w87_legacywad
patchfile = w87_2_legacywad.patch
- commit revision 978
The legacywad filename used cat_filename with a zmalloc buffer,
but cat_filename requires a buffer of MAX_WADPATH because it
terminates it with 0.  This caused segfault at program shutdown.
Fixed to use strdup after the cat_filename call.

*** w87_light255
patchfile = w87_3_light255.patch
- commit revision 979
Light calculations are done in range 0..255.  The LIGHTSEGSHIFT is
only performed at the table lookup.  The extralight is now 0..255.
Calculate the wall orientation light outside of loops.
Simplified much of the light table code.

*** w87_camera
patchfile = w87_4_camera.patch
- commit revision 980
Chase camera is now fixed to be usable with splitscreen players, with
the first player getting the chase camera.
This could be expanded to allow two chase cameras now, but the chase camera
gets hung up going through doorways, so I do not recommend it.

*** w87_viewer_display
patchfile = w87_5_viewer_display.patch
- commit revision 981
Simplified code of player weapon display by using viewer variables.
Disabled debug printf statement concerning netvars.

*** w87_fs_misc
patchfile = w87_5b_fs_misc.patch
- commit revision 982
A portion of w83_fs patches that seems to have got left out.

*** w87_extralight_misc
patchfile = w87_5c_extralight__misc.patch
- commit revision 983
A portion of w87_light255 patch that seems to have got left out.

*** w87_translucent
patchfile = w87_6_translucent.patch
- commit revision 984
Augmented translucent draw to handle alpha of 0..255 for all draw modes.
DRAW8PAL can now draw translucents by reversing translucent table usage.
RGB draw modes can now draw spans using arbitrary alpha.
Simplified flat draw using some new global variables.
Water can now be drawn with a translucent alpha > 128.

*** w87_plane_merge
patchfile = w87_7_plane_merge.patch
- commit revision 985
Hardware render sort changed to merge when adding plane.
Indented code in p_mobj.c.

*** w88_LinkFFloor
patchfile = w88_1_LinkFFloor.patch
- commit revision 986
Changed P_AddFFloor to P_LinkFFloor, for clarity.
Changed flags parameter type to uint32_t.
Cleaned up some comments and indenting.

*** w88_fogwater_decode
patchfile = w88_2_fogwater_decode.patch
- commit revision 987
Create data structures for translucent effects.
Create effect options for "water effect", and "fog effect".
Change linedef decoding for new water and fog effects, affecting
301 (translucent water), 302 (fog), 304 (opaque water).
Each of these can use the following alpha and fog selection.
For opaque water, it only affects the fog inside.
The #xxx in upper texture that set the alpha now also selects the fog
effect, and the alpha can be 0..255.
Syntax  #xxxF, xxx is the alpha (0..255) and F is the effect.
'A': FW_clear, no fog  (old WATER default)
'B': FW_cast,  paint all surfaces with textures
'C': FW_colormap, use colormap fog (which only colors all sectors)
'D': FW_inside, render inside side, plane views (old FOG)
'E': FW_foglite, outside side, plane views, low alpha overall fog sheet
'F': FW_fogdust, outside, when in fog apply overall fog sheet (FOG default)
'G': FW_fogsheet, outside, overall fog sheet, sector join fog sheet
'H': FW_fogfluid, outside, inside fluid, fogsheet
This only handles the linedefs, the code that draws these is in later patches.

*** w88_extralight
patchfile = w88_3_extralight.patch
- commit revision 988
Simplify the addition of extralight and orient light, removing many tests,
by precalculating the extralight for different situations.
Create extralight_cm (3/4 of extralight) for colormap fog,
and extralight_fog (1/2 of extralight) for FF_FOG.
Light precedence is now  FF_FOG, colormap fog, translucent, normal.

*** w88_fogdraw
patchfile = w88_4_fogdraw.patch
- commit revision 989
Rewrite all fog draw functions to new specifications.
Average 3 source texture pixels to generate fog color, except DRAW8PAL
which can only average 2 pixels.
Use of fog alpha.

*** w88_fogface
patchfile = w88_5_fogface.patch
- commit revision 990
Create the fog face sheets needed for some fog modes.
Draw the fog face sheets when in such foggy sectors.

*** w88_fogjoin
patchfile = w88_6_fogjoin.patch
- commit revision 991
Create fog sheets at fog joins for the fogsheet fog model.
This lessens the visibility with distance similar to true fog ray
tracing, but using what is available in this map model.  It tolerates
well mixing fog and non-foggy sectors, which other methods would not.

*** w88_hwfogdraw
patchfile = w88_7_hwfogdraw.patch
- commit revision 992
Adds fog drawing and fog texture creation to hardware renderer.
Draw the fog face sheets when in foggy sectors.

*** w88_hwfogjoin
patchfile = w88_8_hwfogjoin.patch
- commit revision 993
Create fog draws of join sheets for FF_JOIN in hardware render.

*** w88_hw_waterside
patchfile = w88_9_hw_waterside.patch
- commit revision 994
Fix split wall draws so that hardware renderer draws water sides with
3dfloor backsectors, and they are drawn translucent.

*** w88_docs
patchfile = w88_10_docs.patch
- commit revision 995
Update editing and whatsnew for alpha 4 release.

*** fogtst.wad
file = common/wads/fogtst.zip
- commit revision 996
A wad to test fog effects.

*** w88_alpha4
patchfile = w88_11_alpha4.patch
- commit revision 997
Update whatsnew doc for alpha4 release.

*** w88_alpha4_version
patchfile = w88_12_alpha4ver.patch
- commit revision 998
Update alpha4 VERSIONSTRING.

*** w88_blockfill
patchfile = w88_13_blockfill.patch
- commit revision 999
A previous patch ( w86_hw_cache, svn973 ) caused a bug, triggered when an imp
shoots a fireball.
Used the block ptr as a loop var and returned the same to the caller.
Fixed by giving the loop its own copy of the ptr.

*** w89_offset_patch
patchfile = w89_1_offset_patch.patch
- commit revision 1000
FreeDoom is using large patches, with an offset to select a portion.
A single patch texture, with an offset, was generating the wrong
texture.  This detects these and uses the multiple patch combine
generation instead.  Large patches also are directed to multiple patch
combine to avoid multiple large copies of the same patch.

*** w89_savegame_buffer_size
patchfile = w89_2_save_size.patch
- commit revision 1001
Second fix for bug_3442118, where Hell Ground wad (hg.wad) map04
could still overrun the savegame buffer.
Increase savegame min free buffer to 64K.
Requires 12643 to write thinkers of hgh2.wad.  If was close to write
trigger that would overrun the 4K free space.

*** w89_boom_translucent_load
patchfile = w89_3_boom_tranlsu.patch
- commit revision 1002
RGB draw modes sometimes also use translucent table.
Load the lump for all draw modes.

*** w89_hardware_draw_over_deepwater
patchfile = w89_4_hw_draw_deepwater.patch
- commit revision 1003
In ic2005.wad there are three situations where textures are drawn pegged
to mobile deepwater sectors.
1) A translucent over a deepwater door.
2) A transparent texture (electric arc) under a deepwater ceiling.
Pushing a switch turns it on and off.
3) A thin texture used for grid flooring, with deepwater ceiling to move it.
Two sided middle textures must be pegged to the original ceiling,
not to the deepwater sector.
Fixes bug 3169993.

*** w89_heretic_finale
patchfile = w89_5_heretic_finale.patch
- commit revision 1004
Fix bug 0799500.
After Heretic E2M8 ending pic, the palette was not restored.
The finale heretic code now a separate func, another state for heretic
finale has been provided (to avoid showing the cast),
and the palette is restored after the underwater pic has been shown.

*** w89_kill_sfx
patchfile = w89_6_kill_sfx.patch
- commit revision 1005
Fix bug 3078850, chainsaw sound plays full length.
Many fixes in sound effects playing.
Fixed StopSound to work, needed for chainsaw.
Added flags to sounds to control tests and sound killing,
(SFX_single, SFX_id_fin, SFX_saw, SFX_player, SFX_org_kill, and others).
Multiple sfx per origin are allowed as default.
Changed the tests for specific sounds in the port drivers to flag tests.
Updated port sound effect drivers, start sfx, stop sfx, kill flagged
sounds, update sfx param, sound is playing, and get sfx lump.
There is now a common GetSfx, which each port calls to get a sfx lump.
Ports (SDL, linux, os2, macos) now use priority and sound age when
too many channel requests.
Excessive volume detected now uses SoftError, and limits volume instead.
Removed duplicated sfx lump precache from port drivers, so now other
precache options work as intended.
Increased SDL to 16 channels.
The menu pistol sound will get killed early because setup stops sounds
before releasing all the sound memory.  Previously, StopSound
did not work, so memory was released while the pistol was still playing.

*** w89_empty_chan
patchfile = w89_7_empty_chan.patch
- commit revision 1006
Fix SDL find empty channel search.  Search was init wrong.

*** w89_softerr
patchfile = w89_8_softerror.patch
- commit revision 1007
SoftError is mandatory, and no longer a compile option.
SoftError message changed to print "Warn:" instead.

*** w89_free_sound
patchfile = w89_9_free_sound.patch
- commit revision 1008
Fix problems in free memory of sound effect that caused Z_Free errors.
Notable when executing fragglescript ambiant sound (phobia.wad).

*** w89_boom_colormap
patchfile = w89_10_boom_colormap.patch
- commit revision 1009
Fix bug in Boom deepwater colormap support.
Would use bogus colormap at [-1] instead of using no colormap.
Bug would only show in opengl because opengl uses the rgba field instead
of the colormap table field, which was NULL.

*** w89_term_transform
patchfile = w89_11_term_transform.patch
- commit revision 1010
Make hardware render TERM_TRANSFORM the permanent choice, removing
the conditional compilation.  Removed the dead code that this creates.
Rename some functions.
Fix some spelling.

*** w89_corona
patchfile = w89_12_corona.patch
- commit revision 1011
Cleaned the hardware render corona code.
Revised the original corona draw, because it works better with sorted draw.
Created compilation options, and a menu choice.
Corona choices are
  OFF
  SPRITE (drawn with the sprite)
  DYN (drawn from dynamic lights)
  AUTO (decided by draw modes)
The SPRITE draw works the best with transparent walls, as it draws the
corona at the time the sprite is drawn.  This works well with sorted draw.
The DYN corona draw (dynamic lights) does not draw corona behind
translucent walls.
The dynamic lights must remain active because it provides the wall
lighting from things.

*** w89_draw_sorted
patchfile = w89_13_draw_sorted.patch
- commit revision 1012
Hardware drawn sprites would be occluded by transparent walls behind them.
A fixed draw order did not work.
Created hardware draw function that draws sprites and walls together
in depth order.
Draw Menu choices
  EARLY  (draw before sprites, oldest code)
  LATE   (draw after sprites, previous code)
  SORTED (draw sorted with sprites)
The EARLY draw works for transparent, but not translucent.
The LATE draw has distant transparent walls drawn over nearby sprites.
The SORTED draw has sprites drawn correctly for transparent and
translucent walls.
Later this menu item may be removed, with only draw sorted remaining.

*** w90_Makefile
patchfile = w90_1_makefile.patch
- commit revision 1013
Fix debug libs with CDMUS conditional.
Remove old dependencies.

*** w90_malloc
patchfile = w90_2_malloc.patch
- commit revision 1014
Remove old references to malloc.h, except for WATCOM.
Fixes bug 0000602, compiling under FreeBSD.

*** w90_tmap_asm
patchfile = w90_3_tmap_asm.patch
- commit revision 1015
Change asm source for name changes.
  dc_transmap -> dc_translucentmap
  colormaps -> reg_colormaps
Applied patch from Alexey Dokuchaev.
Fixes bug 0000604.
Added dr_alpha test and capability for alpha>128 to asm code.
Fixed asm to increment by vid.ybytes.
Makefile modified for asm support.
Due to complexity, asm will likely lag in getting fixes made to drawers.
It uses strange tricks for speed up, which are difficult to maintain.

*** w90_freemem
patchfile = w90_4_freemem.patch
- commit revision 1016
Fix "Free 0" console printout.
Fix FreeMem interface to indicate when guessing, and suppress printout
of guessed mem numbers.
FreeBSD, remove use of kvm which requires kmem priv, and use sysctl instead.
Applied FreeBSD patch from Alexey Dokuchaev.
Fixes bug 0000610.

*** w90_legacyhome
patchfile = w90_5_legacyhome.patch
- commit revision 1017
Change preferred directory name for savegames to ".doomlegacy"
( "doomlegacy" for win/dos ).
Will also check for ".legacy" (legacy).
When not found, will create ".doomlegacy".
Fixes bug 0000609.

*** W91_rancking
patchfile = w91_1_rancking.patch
- commit revision 1019
Fix rancking spelling to ranking.

*** W91_trans_draw8
patchfile = w91_2_transdraw8.patch
- commit revision 1020
Fix bug in translucent draw of sprite for 8bit screens.
Set dr_alpha to 0 for all translucent sprite draws.
This affects phobia.wad fires, where would get random dr_alpha.

*** W91_flats_limit
patchfile = w91_3_flats_limit.patch
- commit revision 1021
Remove limits on flats.  AddFlats now automatically increases the
levelflats array when necessary.  Remove one use of alloca().

*** W91_alloca
patchfile = w91_4_alloca.patch
- commit revision 1022
Remove uses of alloca, replacing them with calloc, and explicitly
freeing the allocations.

*** W91_drawsetup
patchfile = w91_5_drawsetup.patch
- commit revision 1023
Convert video draw to use a setup function instead of passing a screen
parameter with each call.  Added additional functionality, and made
it more uniform across the various draw functions.  A single V_DrawSetup
now controls the attributes for a series of draw calls.
Added V_DRAWCENTER, to center the splash screen, finale, and menu
screens in the monitor window.

*** W91_bindfraggle
patchfile = w91_6_bindfraggle.patch
- commit revision 1024
Previously I had changed the command t_runscript to fs_runscript, but
now find that chex newmaps binds the t_runscript command to the z key.
Restore previous t_runscript and t_running commands for this purpose.
Chex newmaps scope works again.

*** W91_flats_limit_2
patchfile = w91_7_flatslimit2.patch
- commit revision 1025
Fix bug in W91_flats_limit.  Must zero new levelflats allocation,
because unanimated are left to default values.  Was failing after
about 5 to 7 loads of plutonia savegames.

*** W91_fragglescript_respawn
patchfile = w91_8_fraggle_respawn.patch
- commit revision 1026
Fix bug_3588902.
Create and Free Extra_Mapthing, used for FraggleScript created mobj
that can respawn or can Nightmare respawn.
Savegame now saves Extra_Mapthing as an optional section (see Sync).
This is needed for respawn queue.
Will still load old save games.
Changed savegame ptr tools to also handle savegame mapthing ptrs.
Fixed WRITE_MAPTHING_PTR and READ_MAPTHING_PTR to handle extra mapthing.
Previously they were presented with mapthing ptrs that were not part
of the mapthings array, and created bad indexes in the savegame.
Nightmare respawn modified to fix several bugs.
It had a mixture of previous fixes.  Added better fix for nightmare
respawn at (0,0) as used in prboom and eternity.
Fixed where in several respawn, the mapthing mobj was not being updated
for new mobj.

*** W92_Makefile
patchfile = w92_1_Makefile.patch
- commit revision 1027
Fix bug 0000605, bug 0000608.
Fix Makefile directory create problems.
There is now a make_options file that can hold all the local make
settings, which lessens the need to edit the Makefile.
When this file does not exist, the directories will be made.
Remove directory prerequisites, as they could never work (date changes
with every use).
Fix dependency make problems.  Dependencies are no longer loaded for
many housekeeping make commands, so make does not try to re-build them.
Remove -separate flag from sed.
Fix for compilation on W98 using MinGW.
Other makefile improvements.

Other musserv and sndserv makefiles have been combined with the linux makefile,
because of the duplication of maintenance.
Remove file: linux_x/musserv/Makefile.freebsd
Remove file: linux_x/musserv/Makefile.scoos5
Remove file: linux_x/musserv/Makefile.scouw2
Remove file: linux_x/musserv/Makefile.scouw7
Remove file: linux_x/musserv/Makefile.linux
Remove file: linux_x/sndserv/Makefile.scoos5
Remove file: linux_x/sndserv/Makefile.scouw2
Remove file: linux_x/sndserv/Makefile.scouw7
Add file: linux_x/musserv/Makefile

*** W92_Mac
patchfile = w92_2_Mac.patch
- commit revision 1028
Commit of extensive changes for Mac, and Mac using SDL.
Change MACOS to MACOS_DI (Mac Direct Interface) which is NOT SDL.
Mac using SDL defines MAC_SDL.
This is not a working solution for Mac, just the best current code.
Includes some useful optional debugging code.
Updates Makefile for selecting MAC, and some MAC options.

Add file "sdl/SDLmain.m"

*** W92_WinVid
patchfile = w92_3_winvid.patch
- commit revision 1030
Commit of more changes to video draw in Win32 code to make it
compatible with vid structure.  Untested.

*** W92_OS2_X11
patchfile = w92_4_Os2_X11.patch
- commit revision 1031
Commit of more changes to video draw in OS2 code and Linux X11 code
to make use of new generic video draw functions.  Untested.

*** W92_keys
patchfile = w92_5_keys.patch
- commit revision 1032
Implement changes to keycodes in DOS, OS2, LINUX_X, and WIN32 ports.
Previous changes to Some KEY names were only in SDL.
This only makes it possible to compile and some ports may only have
one usable joystick.  Mostly Untested.

*** W92_stricmp
patchfile = w92_6_stricmp.patch
- commit revision 1033
Change uses of stricmp and strnicmp to strcasecmp and strncasecmp.
Added comments in many places.
Other cleanup.

*** W92_hw_bsp_inits
patchfile = w92_7_hw_bsp_inits.patch
- commit revision 1034
Init some polyvertex variables in hw_bsp.

*** W92_includes
patchfile = w92_8_includes.patch
- commit revision 1035

Addfile  doomincl.h
Removefile  macos/p_spec.h

Reorganize doomdef.h and doomtype.h into:
doomdef.h  = defines only, usable in H files
doomtype.h = typedefs, system detection, usable in H files
doomincl.h = doomdef.h + doomtype.h + common functions and variables
    First include in most C files so that precompiled headers get the
    most benefit.
    Defines WINVER, so doomincl.h must precede some lib includes that would 
    define WINVER first (Redefine error).
    Moved logstream and debugging files to doomincl.h.
Fixed the includes in almost every H and C files.  Added many includes
to cover usage in the H or C file.  Removed some includes due to changes.
Changed include defines to xx_H, to be in our namespace
(and not in the __xx__ namespace, which makes it look like a system name).
General cleanup of things that would not normally be mixed with a code
change.
Cleanup of log headings, removing lines with no maintenance content.
Removed duplicate headers in some files.
Fix some macro naming and collisions.
Added headers to some files that were missing them.
Fixed indentation in some files.
Removed ZZ_Alloc macro, because it had little use and hid usage of Z_Malloc.
This touches almost every file.
Turned off some debugging defines, and changed names to avoid collision.
No code changes were made.

*** W92_winjoy
patchfile = w92_9_winjoy.patch
- commit revision 1036
Fix win32 joystick to use newer joystick interfaces.
Will allow two joysticks.
Untested.

*** W92_WaitVBL
patchfile = w92_10_waitvbl.patch
- commit revision 1037
I_WaitVBL is no longer used by sdl, nor the code, it never worked,
and most ports had dummy functions.
Now there is I_Sleep, that is used (in one place, optionally, as an
experiment).
Removed I_WaitVBL from all the ports, and added an I_Sleep function,
using usleep() from unistd.

- commit revision 1038
w92 10b
Remove extra I_Sleep in sdl.

*** W93_hw_same_vertex
patchfile = w93_1_hw_same_vertex.patch
- commit revision 1040
When using -opengl, FreeDoom Map09 had HOM in one particular passage.
Changed save vertex test to inequality cured the HOM.

*** W93_movecamera
patchfile = w93_2_movecamera.patch
- commit revision 1041
Fragglescript movecamera has only 6 param, but phobiata.wad has a call
with 7 param, and the game would freeze at that point.
Previous updates to fragglescript in W83 fixed the param checking.
Changed movecamera to more gracefully ignore the extra parameter, while
printing a warning message.

*** W93_interface
patchfile = w93_3_interface.patch
- commit revision 1042
Extensive divergence of the port code has occured, with some interfaces
being retired and others created.  Most of the ports had not been
updated.  This updates those critical interfaces and calls.
Makefile updated too, with passage of WIN_NATIVE define.
Filesearch code updated in most ports.

*** W93_ticrate_graph
patchfile = w93_4_ticrate_graph.patch
- commit revision 1043
Move ticrate graph generation to v_video, and remove it from port code.
There is only one copy to maintain now and every port has the same
response to vid_ticrate.
Gave the display a more consistent time axis.

*** W93_win_native
patchfile = w93_5_win_native.patch
- commit revision 1044
Extensive changes to get WIN_NATIVE port working again.
Now works in window and fullscreen, windows draw and Directx draw.
Tested in 8bpp and native bpp.
Has -win parameter to force windows drawing.

*** W93_hw_translu
patchfile = w93_6_hwtranslu.patch
- commit revision 1045
Fix hardware Boom 260 translucent draw of tagged linedefs.

*** W93_screendeg
patchfile = w93_7_screendeg.patch
- commit revision 1046
Add a -screendeg command line option, which is a generalization of
-left and -right.
A few comments and some #ifdef around some unused code.

*** W93_execute_script
patchfile = w93_8_execute_script.patch
- commit revision 1047
Fixes bug_589 (bug_3375763).
The execution of a bind button would fail because the string was parsed
without understanding the escaped quotes within quotes.
Fixed script detection to understand exec lines.
The syntax of button names with spaces in a quoted string is hard to
read, and error prone.  Have given the user the ability to name them with
underlines in place of the spaces.  Such names do not need to be quoted.
If the key name search fails then any underlines in the name are replaced
with spaces, and the key name search retried.  This also allows control
names to have underlines (which they currently do not).
This allows the messy
  alias ps0 "playersprites 0; bind \"mouse 3\" ps1"
to be specified as
  alias ps0 "playersprites 0; bind mouse_3 ps1"
which is much easier to read.

*** W93_docs
patchfile = w93_9_docs.patch
- commit revision 1048
Updated the docs legacy.html and whatsnew.html.

*** W93_viewheight
patchfile = w93_10_viewheight.patch
- commit revision 1049
Fix code that updates player viewheight to provide a slow rise and fall
for changes to the cv_viewheight.  Existing vanilla code could not cope
with changes in cv_viewheight because it required an external setup
to provide the delta.
Fixes bug_1296539.

*** W94_nosecret
patchfile = w94_1_nosecret.patch
- commit revision 1050
When there are no secrets, no possible kills, or no items on a level,
then draw a dash (minus) instead of 0%.

*** W94_mousemenu
patchfile = w94_2_mousemenu.patch
- commit revision 1051
Fix FR 3427586.
The mouse may move the menu ptr while using the keyboard.
The fix disables menu movement from the mouse for a short interval
(about 4 seconds) after each key press.  After the interval the mouse
can be used to move in the menus again.  Does not affect mouse clicks.

*** W94_soundeffect
patchfile = w94_3_soundeffect.patch
- commit revision 1052
Fix sound bugs in hth2.wad.
Read sound lump using plain name too, because hth2.wad does not have ds on
their amb sfx names.  The result was to fail and default to pistol.
Playing hth2.wad has the background ambiance sounds now.
Fixed crash due to using a lump for more than one sfx.  When one was freed
it would corrupt the data of the other.  Had to copy the sound data,
which for some ports is now copied three times.
Fix AddSound to only remove a sound when sfx is full, and to use a
usefulness test.  The newsounds array is removed because it could not
be kept consistant with sfx existance.

*** W94_spritedraw_3dflr
patchfile = w94_4_spritedraw_3dflr.patch
- commit revision 1053
Fix problem with sprite ordering to 3d floors, where sprite on 3d
floor would be drawn under the floor.  This changes plane test to use
middle of sprite instead of toe and head, so that minor overlaps with
adjacent planes do not affect whole sprite.
It does not cure problem with railings, which are higher than dead
objects.

*** W94_demo144
patchfile = w94_5_demo144.patch
- commit revision 1054
Make 144 DL the demo format, with demoversion 144.
Add some fields, and a sync byte.  Fix the playback so that it now
plays our own demos correctly.

*** W94_b_random
patchfile = w94_6_b_random.patch
- commit revision 1055
Create separate random number generators for ambience, bots, and misc.
so that P_Random is not affected by every odd change.
A_Random for ambience, which was using M_Random.  This change should not
affect any demo playback that was working.
B_Random for bots and any other automation.  This was using P_Random
which strongly affects demos.  There should be no existing demos with bots.
New uses should use A_Random and B_Random.

*** W94_infight
patchfile = w94_7_infight.patch
- commit revision 1056
Fix conflict between infight and cv_monbehavior vars.
Include them in demo playing.

*** W94_Boom_demo
patchfile = w94_8_boom_demo.patch
- commit revision 1057
Add some more fixes for playing boom demos.  This fixes some segfault,
and incompatibilities but it still does not sync.
Added Boom stuckdoor code, but only enabled for Boom demo.

*** W95_Boom_MIDI
patchfile = w95_1_boom_midi.patch
- commit revision 1059
Fix playing Boom MIDI lumps on older SDL library.
Also cleaned up and commented the qmus2midi functions and qmus2midi.h.
OS2 was using a file to file version of qmus2midi, which does not seem to
be compiled.  Reconnected buffer to buffer version in OS2.
OS2 needs to be debugged.

*** W95_menu_sounds
patchfile = w95_2_menusounds.patch
- commit revision 1060
Add menu sounds to legacy.wad, and up legacywad version to 1.44.1.
Add menu sounds effects option and cvar.
Adapts menu sounds to game type, such as doom2 and heretic.
Updated legacy.wad from menu.wad.
New Legacy menu sounds are quieter than pistol shot used by Doom2.

*** W95_messages
patchfile = w95_3_messages.patch
- commit revision 1061
Reorganized the printing of messages to the console, stderr, log, and screen.
Created EMSG_flags to select destinations for messages.
There are EMSG selections for stderr text, error, console, log, verbose,
debug, and devparm.
These can be customized by port, and active destinations, without
changing all the print statements.
CONS_Printf and I_SoftError route messages according to the EMSG_flags state
Created GenPrintf() to route verbose and devparm messages to selected
destinations, replacing most uses of fprintf(stderr...).
Verbose and debug messages can now also go to the log and console.

*** W95_find_legacywad
patchfile = w95_4_find_legacywad.patch
- commit revision 1062
Search LEGACYWADDIR, default dir, and doomwaddir for legacy.wad.
Make MAC search of locations more like Linux.
Make access checks easier to maintain.
Simplify the DEFAULTDIR defines, easier to maintain, and all in one place.
Simplify function to create title line.

*** W95_mixer_file
patchfile = w95_5_mixer_file.patch
- commit revision 1063
Using music files with the old mixer has a problem with not being able
to read the file when executing doomlegacy when not in the executable
directory.  This only affects SDL_mixer version < 1.2.7, where the
current is 1.2.11.
Direct reads of the file will succeed, but SDL_LoadMUS() will fail, with
file or directory not found.
Add messages to report the cause of the problem.

*** W95_font1
patchfile = w95_6_font1.patch
- commit revision 1064
Added font1, a fixed width bit mapped font with a default palette,
that can be drawn before loading wads, and without font graphics or
palette from any wads. It is only for software render.

*** W95_early_graphics
patchfile = w95_7_early_graphics.patch
- commit revision 1065
Move the startup of Graphics to as early as possible.
This is to provide an error message screen and menu capability earlier
than before.
Also move Z_Init and COM_Init to be early to allow CV_RegisterVar,
and COM_AddCommand calls.
Fix I_StartupGraphics in all ports to allow calling more than once.
Provide a mode_fullscreen global to the port drivers to isolate them
from any cv_fullscreen setting, that is only used later in the startup
sequence.
Replaced many fprintf(stderr) calls in the port video files, with calls
to GenPrintf.

*** W95_menu
patchfile = w95_8_menu.patch
- commit revision 1066
Fix use of alphaKey field in menus for three conflicting things.
Converted the IT_ defines to an enum.
Added:
  IT_OPTION  = 0x3000,    // field
  IT_YOFFSET = 0x1000,    // alphaKey is offset
  IT_KEYID   = 0x2000,    // alphaKey is id
Changed the control menus to actually use the IT_CONTROL that is defined,
so the tests against IT_CONTROL now make sense.
Added using font1 for printing menu strings when use_font1 is set.

*** W95_linux_x11
patchfile = w95_9_linux_x11.patch
- commit revision 1067
Fix OpenGL failure for X11 video port.
Had to remove some changes made in w71_linux_x because that code is
part of a dll library (r_opengl.so), and the effect was to create two copies
of some variables.
Also, the dll library would not load because it tried to access some
variables in the main code (which it could not link to).
General revision of much of r_opengl dll and i_video_xshm.
Fixed compile of r_opengl dll due to variables, and made its log file
work (it cannot access any main program functions or variables).

*** W95_startscreen
patchfile = w95_10_startscreen.patch
- commit revision 1068
Reorganize the video startup.
I_StartGraphics makes a basic window that can display error messages.
I_RequestFullGraphics makes the transition to fullscreen, hardware modes,
opengl, and video depth selected by command line switches.
Introduce INITIAL_WINDOW size (800x600), which can be selected in doomdef.h.
This usually is large enough to actually read error messages.

*** W95_vidmode
patchfile = w95_11_vidmode.patch
- commit revision 1069
Convert port video function interfaces to use modenum_t, which records the
context of the mode number as well as the index.
Mode indexes have a range, usually 1..n.
Update all the ports to use this interface, although some are
incomplete and would not compile due to other missing functions.
This has changed the video code in many ports which have not been tested
for a long time.

*** W95_launcher
patchfile = w95_12_launcher.patch
- commit revision 1070
Introduce a built-in launcher so DoomLegacy can be started from an icon,
or start menu entry.
If there is an error during wad detection, or if the command line is
empty, the launcher will activate.
It puts up a screen that allows setting most of the command line switches.
The launcher will cycle until the settings do not result in a fatal error.
Once the launcher has accepted the settings, any further errors will
invoke I_Error.
There are a few switches, like -mb, that have already been processed
before the launcher executes.

*** W95_gltranswall
patchfile = w95_13_gltranswall.patch
- commit revision 1071
A negative distance test has been culling visible left walls (chain link).
The test is increased to -2000.0 to eliminate this with known walls.
Walls should not be longer than 1000.

*** W96_gcc4
patchfile = w96_1_gcc4.patch
- commit revision 1072
Compile fixes for gcc4.x complaints.

*** W95_savegamemenu
patchfile = w96_2_savegamemenu.patch
- commit revision 1073
Changes to menu constants in w95_8 exposed a misuse of the menu status field.
The misuse has been fixed with the actual constants the field should have.

*** W96_con_printf
patchfile = w96_3_con_printf.patch
- commit revision 1074
Fix CONS_printf to print on screen during after graphics started and
before entering main loop.
Add EMSG_now, to handle messages that need screen update immediately.
Change some Linux messages to also go to CONS.
Move some hardware messages to use Gen_Printf instead of doing their own
screen update.

*** W96_hw_poly
patchfile = w96_4_hardware_poly.patch
- commit revision 1075
Fix opengl render error that causes some texture draws to be missed.
Not all linesegs are getting into the sector polygons.  Added comments
to polygon code and cleaned up some routines.
Gave poly-vertex their own ptr in the segs, so are never confused with
fixed point vertex.
Added loop to check all segs for having poly-vertex, and add those
that do not so they also render.

Add file: hardware/hw_poly.h

*** W96_win32_native
patchfile = w96_5_win32_native.patch
- commit revision 1076
Updates to win32 native port code so that it compiles.
Fixes code so that it compiles, but execution on my machine is
crashing, which may be due to MinGW and library issues.

*** W96_stuckdoor
patchfile = w96_6_stuckdoor.patch
- commit revision 1079
Enable Monster stuck in door fixes from MBF and Boom.
Adv. Menu gets the stuckdoor control.
Saved to demo header and config.

*** W96_hw_misc
patchfile = w96_7_hw_misc.patch
- commit revision 1080
Change tests against -1 to < 0 or >= 0, to be more robust.
Fix Loading percentage box by setting Draw options properly.

*** W96_gdesc
patchfile = w96_8_gdesc.patch
- commit revision 1081
Update wad recognition
FreeDoom:
  file = "freedoom2.wad", "freedoom.wad", "doom2.wad"
Ultimate Freedoom:
  file = "freedoom1.wad", "freedu.wad", "doomu.wad"
Blasphemer:
  file = "BLASPHEM.WAD", "blasphem.wad", "heretic.wad"
Ultimate mode:
  mode = ultdoom_retail

*** W96_docs
patchfile = w96_9_docs.patch
- commit revision 1082
Update docs for revsion 1.45.

*** W96_cleardisplay
patchfile = w96_10_cleardisplay.patch
- commit revision 1083
Add V_ClearDisplay function to give decent display clear for OpenGL.
Fixes ghosting during CONS print scrolling.

*** W96_SoftError_text
patchfile = w96_11_softerror_text.patch
- commit revision 1084
Have CONS_Print do all of SoftError printing, so only stderr and stdout
only get one copy of the error message.

*** W96_OpenGL_func
patchfile = w96_12_opengl_func.patch
- commit revision 1085
Renamed some r_opengl funcs to VIDGL_xxx, so to identify them.
Renamed DL_SET_PALETTECOLOR to DL_SET_TINT_COLOR, to identify it as
the tint applied to opengl to imitate the palette flash.
Improved the efficiency of some r_opengl functions.
Separated DEBUG_SDL from DEBUG_MAC.

*** W96_win_sdl
patchfile = w96_13_win_sdl.patch
- commit revision 1086
Fixes several problems with SDL on win32 machine.
Fade of menu background is problem on Matrox.
Fixes to little white texture, which Linux does not seem to need.
Use glGenTextures, because the first texture id returned by it changes
on the second call.
OpenGL drawing everything in Red and Yellow was only fixed by
disabling Matrox polygon accell.
May still be an open issue, so some DEBUG_WIN code is still present.

*** W96_linux_event
patchfile = w96_14_linux_event.patch
- commit revision 1087
Update Linux event loop to be same as in SDL, to eliminate compiler
complaints.

*** W96_alpha5
patchfile = w96_15_alpha5.patch
- commit revision 1088
Revert VERSION and docs to 1.44 alpha5.
Fix check on legacy wadversion to accept 1.44 and 1.45.
The legacy.wad remains at 1.45.

*** W96_verbose
patchfile = w96_13c_verbose.patch
- commit revision 1089
Part of w96_win_sdl that did not get commit properly.
Removes use of verbose in opengl, because Linux_X will make a dll, and
the verbose will not be resolved at run-time.

*** W97_savegame_menu
patchfile = w97_1_savegame_menu.patch
- commit revision 1092
Fix several problems with savegame menu behavior.
Savegame menus will no longer wrap to top of menu.
They will return to the current scroll position when the menu is used
again.
Cleared status on unused savegame slots to prevent loading from them.
Added some SAVEGAME defined names to replace constants, and used them
throughout the savegame menu code.  This removed some latent bugs in places
where the code was not properly accounting for SAVEGAME compile options.
Clarified some of the names, organization, and use different names for
menu slots and savegame slots.

*** W97_fineangle
patchfile = w97_2_fineangle.patch
- commit revision 1093
The use of the sine, cosine, and tangent tables is complicated by
requiring several constants and a shift.  This has been encapsulated
in some macros that apply the FINESHIFT.
There also are some inline functions, but using them proved to be
inefficient, based on the increase in the file size.
The usages of FINESHIFT have been converted to use the new macros where
possible. Many usages use the fine angle table indexes more than once
(sine and cosine) and it proved to be difficult to hide the workings.
The most efficient code was favored which restricted the usage of the
new macros in many places.

*** W97_distance_angle
patchfile = w97_3_distangle.patch
- commit revision 1094
Fix some of the rendering errors with distant walls.  This was due to
errors in the angles to the wall end points.  The vanilla PointToAngle function
is so inaccurate that it hardly has any valid bits (5 out of 32 bits).
At that distance the error causes the left and right angle values to
have the wrong magnitude order (non-monotonic).  This causes some far walls to
be drawn over nearer walls, but not correctly, many times with HOM.
A more accurate function, SlopeDive_64, has been introduced, which
brings the accuracy up to 13 bits out of 32 bits (when compared to atan2).
This fixes most of the render errors on Europe.wad and longdays.wad.
There are still some walls not rendered due to distance, but they do not
occlude the nearer walls.

*** W97_hw_fineangle
patchfile = w97_4_hw_fineangle.patch
- commit revision 1095
Extend the FINEANGLE patches to the hardware code.

*** W97_hw_distance_angle
patchfile = w97_5_hw_distangle.patch
- commit revision 1096
Extend the distangle patches to the hardware code.
This does not have much effect because the OpenGL renderer has another
distance limit.  It does not draw the far distant walls at all.

*** W97_morphmobj
patchfile = w97_6_morphmobj.patch
- commit revision 1097
Change Heretic chicken to use a MorphMobj function that preserves the
current player mobj.  Fixes the Chicken and SkullPop functions to not
change the player mobj.  They would do so during Line attacks and
Damage.  This makes it safe for functions to keep a ptr to the player mobj.
Fix the Chicken attack to set the PuffType.  This stops the chicken
attack from creating a bogus player mobj on top of the attacked monster.

*** W97_playermobj
patchfile = w97_7_playermobj.patch
- commit revision 1098
Have many functions keep a variable to the player mobj (pmo).
This improves readability and reduces size a bit.
Cleanup some of the heretic code.  This is mostly indenting.
This does not change functionality.

*** W97_cleanup_indent
patchfile = w97_8_cleanup.patch
- commit revision 1099
Cleanup arrangement of many functions.
This is mostly line organization and indenting.
Some extern are moved to headers.  Some variables are renamed.
Some more uses of ANGLEFINESHIFT are changed to use ANGLE_TO_FINE().
This does not change functionality.

*** W97_bot
patchfile = w97_9_bot.patch
- commit revision 1100
Cleanup the bot code.  This is mostly indenting.
Some function sections were altered to use tables.
Some variables were added to share common calculations and remove
duplicate code.
This does not change functionality.

*** W97_quicksave
patchfile = w97_10_quicksave.patch
- commit revision 1101
The quicksave has been saving its descriptor one beyond the end of the
save descriptor array, overwriting several quicksave and save variables.
Every once and a while this causes a segfault, due to a corrupted slotindex.
This patch fixes the QUICKSAVE_INDEX, so it actually uses the last entry in
the array now.

*** W97_large_dist
patchfile = w97_11_large_dist.patch
- commit revision 1102
The previous patch, W97_distance_angle, did not completely fix
occurances of bad angles.  This patch has large distances ( x or y > 1/4 MAX)
use the atan2 function to calculate the angle, a fix from PrBoom.
It is slower but accurate.

*** W97_version145
patchfile = w97_12_version145.patch
- commit revision 1103
Update docs and version numbers for 1.45.

*** W97_patch_segfault
patchfile = w97_13_patch_sf.patch
- commit revision 1104
Legacy demo segfaults because a colormap is getting used as a patch in
a texture.  They both have the same name, BLUMAP.
This patch stops the segfault by detecting when a patch offset will
overrun the patch size.

*** W97_lumpnum
patchfile = w97_14_lumpnum.patch
- commit revision 1105
Cleanup some lump numbering by using some existing macros.
Some comments.

*** W97_lump_namespace
patchfile = w97_15_lump_namespace.patch
- commit revision 1106
Implement tracking of the wad namespace in the lump info.
A patch lump will be searched for within the PATCH namespace first,
and if not found then any lump of that name will be used.
This fixes the Legacy demo wad so the BLUMAP colormap and BLUMAP patch
occupy different namespaces.  The texture using the BLUMAP patch now
finds the correct lump and does not need to be rejected.

*** W97_wi_stats
patchfile = w97_16_wi_stats.patch
- commit revision 1107
Some player stats use a division by the total.  In wads where the
total was 0, there would be a division by zero.  There was inadequate
protection.  The protecting tests were expanded to protect all
divisions by the total.
Update docs to latest patches.

*** W100_savegame144
patchfile = w100_1_savegame144.patch
- commit revision 1115
The savegame format is the same in 1.45 as it is in 1.44, so allow it
to read 1.44 version savegames too.  Version 1.44 savegames may be
readable for many versions because of the coded modular nature of additions
to the format.

*** W100_DEH_Boss_death
patchfile = w100_2_DEH_Boss_death.patch
- commit revision 1116
DEH modified monsters should be able to trigger the Boss_death function
by using the Keen_death. This will trigger tag=666 sectors.
This restores the ability that was present in Vanilla Doom.

*** W100_infight
patchfile = w100_3_infight.patch
- commit revision 1117
Changes the way the menu infight control interacts with demo infight
settings and DEH infight selections.  The previous coop and infight
settings are defaults that can be overridden by DEH infight settings.
This is similar to other ports, and seems to be the expected behavior.
Added separate "Force Coop" and "Force Infight" menu control settings
that will override any DEH infight settings.  This allows the user to
still modify the infight behavior when they want.

*** W100_nomonsters
patchfile = w100_4_nomonsters.patch
- commit revision 1118
Restore the -nomonsters switch that got lost in the w95_startscreen patch.
Had intended to move it and lost it entirely instead.
There is no equivalent menu control.

*** W100_spawnfly
patchfile = w100_5_spawnfly.patch
- commit revision 1119
If a savegame has a flying cube, there may be a segfault.  The savegame
does not handle saving a braintarget as a mobj.  This fixes the SpawnFly
to get the previous braintarget when mobj->target is NULL.
This protects the flying cube code, and perhaps the savegame can be fixed
later too.

*** W100_docs
patchfile = w100_6_docs.patch
- commit revision 1120
Update docs for 1.45.1 bug fixes.

*** W100_stuck_3dfloor
patchfile = w100_7_stuck_3dfloor.patch
- commit revision 11??
Fix things collision check to ignore things on other 3dfloors.
The allows monsters placed on upper and lower floors to not get stuck
to each other.
Also make the things collision check not block for NOCLIP and not SOLID,
same as in prboom and compatible with boom demo.

*** W100_memtag
patchfile = w100_8_memtag.patch
- commit revision 11??
Change z_zone memory block tag to be named memtag, so that it does not
get confused with the linedef tag.

*** W100_flush
patchfile = w100_9_flush.patch
- commit revision 11??
Flush messages so the appear sooner.

*** W100_opengl_menu
patchfile = w100_10_opengl_menu.patch
- commit revision 11??
Straighten out some positioning in the opengl menu options, and gamma.

*** W100_opengl_tnt_doors
patchfile = w100_11_opengl_tntdoors.patch
- commit revision 11??
Fix the OpenGL rendering of the transparent doors in TNT Map21.
They need to be rendered full height when the middle texture is transparent
and the door is closed.

*** W100_makefile
patchfile = w100_12_makefile.patch
- commit revision 11??
Modify makefile for development work in the new directory structure.
It needed to support more options for compiling from alternative
working directories.

*** W100_docs2
patchfile = w100_13_docs2.patch
- commit revision 11??
Update docs for latest patches.


